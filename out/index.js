var WQ=Object.create;var{defineProperty:GJ,getPrototypeOf:YQ,getOwnPropertyNames:zQ}=Object;var $Q=Object.prototype.hasOwnProperty;var u1=(J,X,Q)=>{Q=J!=null?WQ(YQ(J)):{};const Z=X||!J||!J.__esModule?GJ(Q,"default",{value:J,enumerable:!0}):Q;for(let G of zQ(J))if(!$Q.call(Z,G))GJ(Z,G,{get:()=>J[G],enumerable:!0});return Z};var HJ=(J,X)=>()=>(X||J((X={exports:{}}).exports,X),X.exports);var x0=(J,X)=>{for(var Q in X)GJ(J,Q,{get:X[Q],enumerable:!0,configurable:!0,set:(Z)=>X[Q]=()=>Z})};var G0=((J)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(J,{get:(X,Q)=>(typeof require!=="undefined"?require:X)[Q]}):J)(function(J){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+J+'" is not supported')});var KJ=HJ((bX,VJ)=>{/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(J){if(typeof bX==="object"&&typeof VJ!=="undefined")VJ.exports=J();else if(typeof define==="function"&&define.amd)define([],J);else{var X;if(typeof window!=="undefined")X=window;else if(typeof global!=="undefined")X=global;else if(typeof self!=="undefined")X=self;else X=this;X.localforage=J()}})(function(){var J,X,Q;return function Z(G,H,K){function W(q,M){if(!H[q]){if(!G[q]){var O=typeof G0=="function"&&G0;if(!M&&O)return O(q,!0);if(z)return z(q,!0);var P=new Error("Cannot find module '"+q+"'");throw P.code="MODULE_NOT_FOUND",P}var b=H[q]={exports:{}};G[q][0].call(b.exports,function(n){var N1=G[q][1][n];return W(N1?N1:n)},b,b.exports,Z,G,H,K)}return H[q].exports}var z=typeof G0=="function"&&G0;for(var F=0;F<K.length;F++)W(K[F]);return W}({1:[function(Z,G,H){(function(K){var W=K.MutationObserver||K.WebKitMutationObserver,z;if(W){var F=0,q=new W(n),M=K.document.createTextNode("");q.observe(M,{characterData:!0}),z=function(){M.data=F=++F%2}}else if(!K.setImmediate&&typeof K.MessageChannel!=="undefined"){var O=new K.MessageChannel;O.port1.onmessage=n,z=function(){O.port2.postMessage(0)}}else if("document"in K&&"onreadystatechange"in K.document.createElement("script"))z=function(){var G1=K.document.createElement("script");G1.onreadystatechange=function(){n(),G1.onreadystatechange=null,G1.parentNode.removeChild(G1),G1=null},K.document.documentElement.appendChild(G1)};else z=function(){setTimeout(n,0)};var P,b=[];function n(){P=!0;var G1,P1,e=b.length;while(e){P1=b,b=[],G1=-1;while(++G1<e)P1[G1]();e=b.length}P=!1}G.exports=N1;function N1(G1){if(b.push(G1)===1&&!P)z()}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(Z,G,H){var K=Z(1);function W(){}var z={},F=["REJECTED"],q=["FULFILLED"],M=["PENDING"];G.exports=O;function O(C){if(typeof C!=="function")throw new TypeError("resolver must be a function");if(this.state=M,this.queue=[],this.outcome=void 0,C!==W)N1(this,C)}O.prototype.catch=function(C){return this.then(null,C)},O.prototype.then=function(C,l){if(typeof C!=="function"&&this.state===q||typeof l!=="function"&&this.state===F)return this;var p=new this.constructor(W);if(this.state!==M){var i=this.state===q?C:l;b(p,i,this.outcome)}else this.queue.push(new P(p,C,l));return p};function P(C,l,p){if(this.promise=C,typeof l==="function")this.onFulfilled=l,this.callFulfilled=this.otherCallFulfilled;if(typeof p==="function")this.onRejected=p,this.callRejected=this.otherCallRejected}P.prototype.callFulfilled=function(C){z.resolve(this.promise,C)},P.prototype.otherCallFulfilled=function(C){b(this.promise,this.onFulfilled,C)},P.prototype.callRejected=function(C){z.reject(this.promise,C)},P.prototype.otherCallRejected=function(C){b(this.promise,this.onRejected,C)};function b(C,l,p){K(function(){var i;try{i=l(p)}catch(K1){return z.reject(C,K1)}if(i===C)z.reject(C,new TypeError("Cannot resolve promise with itself"));else z.resolve(C,i)})}z.resolve=function(C,l){var p=G1(n,l);if(p.status==="error")return z.reject(C,p.value);var i=p.value;if(i)N1(C,i);else{C.state=q,C.outcome=l;var K1=-1,w=C.queue.length;while(++K1<w)C.queue[K1].callFulfilled(l)}return C},z.reject=function(C,l){C.state=F,C.outcome=l;var p=-1,i=C.queue.length;while(++p<i)C.queue[p].callRejected(l);return C};function n(C){var l=C&&C.then;if(C&&(typeof C==="object"||typeof C==="function")&&typeof l==="function")return function p(){l.apply(C,arguments)}}function N1(C,l){var p=!1;function i(H1){if(p)return;p=!0,z.reject(C,H1)}function K1(H1){if(p)return;p=!0,z.resolve(C,H1)}function w(){l(K1,i)}var U1=G1(w);if(U1.status==="error")i(U1.value)}function G1(C,l){var p={};try{p.value=C(l),p.status="success"}catch(i){p.status="error",p.value=i}return p}O.resolve=P1;function P1(C){if(C instanceof this)return C;return z.resolve(new this(W),C)}O.reject=e;function e(C){var l=new this(W);return z.reject(l,C)}O.all=g1;function g1(C){var l=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var p=C.length,i=!1;if(!p)return this.resolve([]);var K1=new Array(p),w=0,U1=-1,H1=new this(W);while(++U1<p)D(C[U1],U1);return H1;function D(R,h){l.resolve(R).then(j,function(y){if(!i)i=!0,z.reject(H1,y)});function j(y){if(K1[h]=y,++w===p&&!i)i=!0,z.resolve(H1,K1)}}}O.race=f1;function f1(C){var l=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var p=C.length,i=!1;if(!p)return this.resolve([]);var K1=-1,w=new this(W);while(++K1<p)U1(C[K1]);return w;function U1(H1){l.resolve(H1).then(function(D){if(!i)i=!0,z.resolve(w,D)},function(D){if(!i)i=!0,z.reject(w,D)})}}},{"1":1}],3:[function(Z,G,H){(function(K){if(typeof K.Promise!=="function")K.Promise=Z(2)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"2":2}],4:[function(Z,G,H){var K=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol==="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V};function W(V,$){if(!(V instanceof $))throw new TypeError("Cannot call a class as a function")}function z(){try{if(typeof indexedDB!=="undefined")return indexedDB;if(typeof webkitIndexedDB!=="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!=="undefined")return mozIndexedDB;if(typeof OIndexedDB!=="undefined")return OIndexedDB;if(typeof msIndexedDB!=="undefined")return msIndexedDB}catch(V){return}}var F=z();function q(){try{if(!F||!F.open)return!1;var V=typeof openDatabase!=="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),$=typeof fetch==="function"&&fetch.toString().indexOf("[native code")!==-1;return(!V||$)&&typeof indexedDB!=="undefined"&&typeof IDBKeyRange!=="undefined"}catch(Y){return!1}}function M(V,$){V=V||[],$=$||{};try{return new Blob(V,$)}catch(B){if(B.name!=="TypeError")throw B;var Y=typeof BlobBuilder!=="undefined"?BlobBuilder:typeof MSBlobBuilder!=="undefined"?MSBlobBuilder:typeof MozBlobBuilder!=="undefined"?MozBlobBuilder:WebKitBlobBuilder,A=new Y;for(var E=0;E<V.length;E+=1)A.append(V[E]);return A.getBlob($.type)}}if(typeof Promise==="undefined")Z(3);var O=Promise;function P(V,$){if($)V.then(function(Y){$(null,Y)},function(Y){$(Y)})}function b(V,$,Y){if(typeof $==="function")V.then($);if(typeof Y==="function")V.catch(Y)}function n(V){if(typeof V!=="string")console.warn(V+" used as a key, but it is not a string."),V=String(V);return V}function N1(){if(arguments.length&&typeof arguments[arguments.length-1]==="function")return arguments[arguments.length-1]}var G1="local-forage-detect-blob-support",P1=void 0,e={},g1=Object.prototype.toString,f1="readonly",C="readwrite";function l(V){var $=V.length,Y=new ArrayBuffer($),A=new Uint8Array(Y);for(var E=0;E<$;E++)A[E]=V.charCodeAt(E);return Y}function p(V){return new O(function($){var Y=V.transaction(G1,C),A=M([""]);Y.objectStore(G1).put(A,"key"),Y.onabort=function(E){E.preventDefault(),E.stopPropagation(),$(!1)},Y.oncomplete=function(){var E=navigator.userAgent.match(/Chrome\/(\d+)/),B=navigator.userAgent.match(/Edge\//);$(B||!E||parseInt(E[1],10)>=43)}}).catch(function(){return!1})}function i(V){if(typeof P1==="boolean")return O.resolve(P1);return p(V).then(function($){return P1=$,P1})}function K1(V){var $=e[V.name],Y={};if(Y.promise=new O(function(A,E){Y.resolve=A,Y.reject=E}),$.deferredOperations.push(Y),!$.dbReady)$.dbReady=Y.promise;else $.dbReady=$.dbReady.then(function(){return Y.promise})}function w(V){var $=e[V.name],Y=$.deferredOperations.pop();if(Y)return Y.resolve(),Y.promise}function U1(V,$){var Y=e[V.name],A=Y.deferredOperations.pop();if(A)return A.reject($),A.promise}function H1(V,$){return new O(function(Y,A){if(e[V.name]=e[V.name]||u(),V.db)if($)K1(V),V.db.close();else return Y(V.db);var E=[V.name];if($)E.push(V.version);var B=F.open.apply(F,E);if($)B.onupgradeneeded=function(_){var U=B.result;try{if(U.createObjectStore(V.storeName),_.oldVersion<=1)U.createObjectStore(G1)}catch(x){if(x.name==="ConstraintError")console.warn('The database "'+V.name+'" has been upgraded from version '+_.oldVersion+" to version "+_.newVersion+', but the storage "'+V.storeName+'" already exists.');else throw x}};B.onerror=function(_){_.preventDefault(),A(B.error)},B.onsuccess=function(){var _=B.result;_.onversionchange=function(U){U.target.close()},Y(_),w(V)}})}function D(V){return H1(V,!1)}function R(V){return H1(V,!0)}function h(V,$){if(!V.db)return!0;var Y=!V.db.objectStoreNames.contains(V.storeName),A=V.version<V.db.version,E=V.version>V.db.version;if(A){if(V.version!==$)console.warn('The database "'+V.name+`" can't be downgraded from version `+V.db.version+" to version "+V.version+".");V.version=V.db.version}if(E||Y){if(Y){var B=V.db.version+1;if(B>V.version)V.version=B}return!0}return!1}function j(V){return new O(function($,Y){var A=new FileReader;A.onerror=Y,A.onloadend=function(E){var B=btoa(E.target.result||"");$({__local_forage_encoded_blob:!0,data:B,type:V.type})},A.readAsBinaryString(V)})}function y(V){var $=l(atob(V.data));return M([$],{type:V.type})}function k(V){return V&&V.__local_forage_encoded_blob}function f(V){var $=this,Y=$._initReady().then(function(){var A=e[$._dbInfo.name];if(A&&A.dbReady)return A.dbReady});return b(Y,V,V),Y}function I(V){K1(V);var $=e[V.name],Y=$.forages;for(var A=0;A<Y.length;A++){var E=Y[A];if(E._dbInfo.db)E._dbInfo.db.close(),E._dbInfo.db=null}return V.db=null,D(V).then(function(B){if(V.db=B,h(V))return R(V);return B}).then(function(B){V.db=$.db=B;for(var _=0;_<Y.length;_++)Y[_]._dbInfo.db=B}).catch(function(B){throw U1(V,B),B})}function v(V,$,Y,A){if(A===void 0)A=1;try{var E=V.db.transaction(V.storeName,$);Y(null,E)}catch(B){if(A>0&&(!V.db||B.name==="InvalidStateError"||B.name==="NotFoundError"))return O.resolve().then(function(){if(!V.db||B.name==="NotFoundError"&&!V.db.objectStoreNames.contains(V.storeName)&&V.version<=V.db.version){if(V.db)V.version=V.db.version+1;return R(V)}}).then(function(){return I(V).then(function(){v(V,$,Y,A-1)})}).catch(Y);Y(B)}}function u(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function d(V){var $=this,Y={db:null};if(V)for(var A in V)Y[A]=V[A];var E=e[Y.name];if(!E)E=u(),e[Y.name]=E;if(E.forages.push($),!$._initReady)$._initReady=$.ready,$.ready=f;var B=[];function _(){return O.resolve()}for(var U=0;U<E.forages.length;U++){var x=E.forages[U];if(x!==$)B.push(x._initReady().catch(_))}var L=E.forages.slice(0);return O.all(B).then(function(){return Y.db=E.db,D(Y)}).then(function(N){if(Y.db=N,h(Y,$._defaultConfig.version))return R(Y);return N}).then(function(N){Y.db=E.db=N,$._dbInfo=Y;for(var g=0;g<L.length;g++){var c=L[g];if(c!==$)c._dbInfo.db=Y.db,c._dbInfo.version=Y.version}})}function q1(V,$){var Y=this;V=n(V);var A=new O(function(E,B){Y.ready().then(function(){v(Y._dbInfo,f1,function(_,U){if(_)return B(_);try{var x=U.objectStore(Y._dbInfo.storeName),L=x.get(V);L.onsuccess=function(){var N=L.result;if(N===void 0)N=null;if(k(N))N=y(N);E(N)},L.onerror=function(){B(L.error)}}catch(N){B(N)}})}).catch(B)});return P(A,$),A}function s(V,$){var Y=this,A=new O(function(E,B){Y.ready().then(function(){v(Y._dbInfo,f1,function(_,U){if(_)return B(_);try{var x=U.objectStore(Y._dbInfo.storeName),L=x.openCursor(),N=1;L.onsuccess=function(){var g=L.result;if(g){var c=g.value;if(k(c))c=y(c);var a=V(c,g.key,N++);if(a!==void 0)E(a);else g.continue()}else E()},L.onerror=function(){B(L.error)}}catch(g){B(g)}})}).catch(B)});return P(A,$),A}function T1(V,$,Y){var A=this;V=n(V);var E=new O(function(B,_){var U;A.ready().then(function(){if(U=A._dbInfo,g1.call($)==="[object Blob]")return i(U.db).then(function(x){if(x)return $;return j($)});return $}).then(function(x){v(A._dbInfo,C,function(L,N){if(L)return _(L);try{var g=N.objectStore(A._dbInfo.storeName);if(x===null)x=void 0;var c=g.put(x,V);N.oncomplete=function(){if(x===void 0)x=null;B(x)},N.onabort=N.onerror=function(){var a=c.error?c.error:c.transaction.error;_(a)}}catch(a){_(a)}})}).catch(_)});return P(E,Y),E}function J1(V,$){var Y=this;V=n(V);var A=new O(function(E,B){Y.ready().then(function(){v(Y._dbInfo,C,function(_,U){if(_)return B(_);try{var x=U.objectStore(Y._dbInfo.storeName),L=x.delete(V);U.oncomplete=function(){E()},U.onerror=function(){B(L.error)},U.onabort=function(){var N=L.error?L.error:L.transaction.error;B(N)}}catch(N){B(N)}})}).catch(B)});return P(A,$),A}function Q1(V){var $=this,Y=new O(function(A,E){$.ready().then(function(){v($._dbInfo,C,function(B,_){if(B)return E(B);try{var U=_.objectStore($._dbInfo.storeName),x=U.clear();_.oncomplete=function(){A()},_.onabort=_.onerror=function(){var L=x.error?x.error:x.transaction.error;E(L)}}catch(L){E(L)}})}).catch(E)});return P(Y,V),Y}function U0(V){var $=this,Y=new O(function(A,E){$.ready().then(function(){v($._dbInfo,f1,function(B,_){if(B)return E(B);try{var U=_.objectStore($._dbInfo.storeName),x=U.count();x.onsuccess=function(){A(x.result)},x.onerror=function(){E(x.error)}}catch(L){E(L)}})}).catch(E)});return P(Y,V),Y}function m1(V,$){var Y=this,A=new O(function(E,B){if(V<0){E(null);return}Y.ready().then(function(){v(Y._dbInfo,f1,function(_,U){if(_)return B(_);try{var x=U.objectStore(Y._dbInfo.storeName),L=!1,N=x.openKeyCursor();N.onsuccess=function(){var g=N.result;if(!g){E(null);return}if(V===0)E(g.key);else if(!L)L=!0,g.advance(V);else E(g.key)},N.onerror=function(){B(N.error)}}catch(g){B(g)}})}).catch(B)});return P(A,$),A}function i1(V){var $=this,Y=new O(function(A,E){$.ready().then(function(){v($._dbInfo,f1,function(B,_){if(B)return E(B);try{var U=_.objectStore($._dbInfo.storeName),x=U.openKeyCursor(),L=[];x.onsuccess=function(){var N=x.result;if(!N){A(L);return}L.push(N.key),N.continue()},x.onerror=function(){E(x.error)}}catch(N){E(N)}})}).catch(E)});return P(Y,V),Y}function M1(V,$){$=N1.apply(this,arguments);var Y=this.config();if(V=typeof V!=="function"&&V||{},!V.name)V.name=V.name||Y.name,V.storeName=V.storeName||Y.storeName;var A=this,E;if(!V.name)E=O.reject("Invalid arguments");else{var B=V.name===Y.name&&A._dbInfo.db,_=B?O.resolve(A._dbInfo.db):D(V).then(function(U){var x=e[V.name],L=x.forages;x.db=U;for(var N=0;N<L.length;N++)L[N]._dbInfo.db=U;return U});if(!V.storeName)E=_.then(function(U){K1(V);var x=e[V.name],L=x.forages;U.close();for(var N=0;N<L.length;N++){var g=L[N];g._dbInfo.db=null}var c=new O(function(a,r){var Y1=F.deleteDatabase(V.name);Y1.onerror=function(){var W1=Y1.result;if(W1)W1.close();r(Y1.error)},Y1.onblocked=function(){console.warn('dropInstance blocked for database "'+V.name+'" until all open connections are closed')},Y1.onsuccess=function(){var W1=Y1.result;if(W1)W1.close();a(W1)}});return c.then(function(a){x.db=a;for(var r=0;r<L.length;r++){var Y1=L[r];w(Y1._dbInfo)}}).catch(function(a){throw(U1(V,a)||O.resolve()).catch(function(){}),a})});else E=_.then(function(U){if(!U.objectStoreNames.contains(V.storeName))return;var x=U.version+1;K1(V);var L=e[V.name],N=L.forages;U.close();for(var g=0;g<N.length;g++){var c=N[g];c._dbInfo.db=null,c._dbInfo.version=x}var a=new O(function(r,Y1){var W1=F.open(V.name,x);W1.onerror=function(I1){var Z0=W1.result;Z0.close(),Y1(I1)},W1.onupgradeneeded=function(){var I1=W1.result;I1.deleteObjectStore(V.storeName)},W1.onsuccess=function(){var I1=W1.result;I1.close(),r(I1)}});return a.then(function(r){L.db=r;for(var Y1=0;Y1<N.length;Y1++){var W1=N[Y1];W1._dbInfo.db=r,w(W1._dbInfo)}}).catch(function(r){throw(U1(V,r)||O.resolve()).catch(function(){}),r})})}return P(E,$),E}var C1={_driver:"asyncStorage",_initStorage:d,_support:q(),iterate:s,getItem:q1,setItem:T1,removeItem:J1,clear:Q1,length:U0,key:m1,keys:i1,dropInstance:M1};function X1(){return typeof openDatabase==="function"}var _1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h1="~~local_forage_type~",s1=/^~~local_forage_type~([^~]+)~/,x1="__lfsc__:",t1=x1.length,X0="arbf",b1="blob",TX="si08",xX="ui08",LX="uic8",NX="si16",PX="si32",DX="ur16",CX="ui32",hX="fl32",IX="fl64",yX=t1+X0.length,jX=Object.prototype.toString;function SX(V){var $=V.length*0.75,Y=V.length,A,E=0,B,_,U,x;if(V[V.length-1]==="="){if($--,V[V.length-2]==="=")$--}var L=new ArrayBuffer($),N=new Uint8Array(L);for(A=0;A<Y;A+=4)B=_1.indexOf(V[A]),_=_1.indexOf(V[A+1]),U=_1.indexOf(V[A+2]),x=_1.indexOf(V[A+3]),N[E++]=B<<2|_>>4,N[E++]=(_&15)<<4|U>>2,N[E++]=(U&3)<<6|x&63;return L}function r0(V){var $=new Uint8Array(V),Y="",A;for(A=0;A<$.length;A+=3)Y+=_1[$[A]>>2],Y+=_1[($[A]&3)<<4|$[A+1]>>4],Y+=_1[($[A+1]&15)<<2|$[A+2]>>6],Y+=_1[$[A+2]&63];if($.length%3===2)Y=Y.substring(0,Y.length-1)+"=";else if($.length%3===1)Y=Y.substring(0,Y.length-2)+"==";return Y}function L9(V,$){var Y="";if(V)Y=jX.call(V);if(V&&(Y==="[object ArrayBuffer]"||V.buffer&&jX.call(V.buffer)==="[object ArrayBuffer]")){var A,E=x1;if(V instanceof ArrayBuffer)A=V,E+=X0;else if(A=V.buffer,Y==="[object Int8Array]")E+=TX;else if(Y==="[object Uint8Array]")E+=xX;else if(Y==="[object Uint8ClampedArray]")E+=LX;else if(Y==="[object Int16Array]")E+=NX;else if(Y==="[object Uint16Array]")E+=DX;else if(Y==="[object Int32Array]")E+=PX;else if(Y==="[object Uint32Array]")E+=CX;else if(Y==="[object Float32Array]")E+=hX;else if(Y==="[object Float64Array]")E+=IX;else $(new Error("Failed to get type for BinaryArray"));$(E+r0(A))}else if(Y==="[object Blob]"){var B=new FileReader;B.onload=function(){var _=h1+V.type+"~"+r0(this.result);$(x1+b1+_)},B.readAsArrayBuffer(V)}else try{$(JSON.stringify(V))}catch(_){console.error("Couldn't convert value into a JSON string: ",V),$(null,_)}}function N9(V){if(V.substring(0,t1)!==x1)return JSON.parse(V);var $=V.substring(yX),Y=V.substring(t1,yX),A;if(Y===b1&&s1.test($)){var E=$.match(s1);A=E[1],$=$.substring(E[0].length)}var B=SX($);switch(Y){case X0:return B;case b1:return M([B],{type:A});case TX:return new Int8Array(B);case xX:return new Uint8Array(B);case LX:return new Uint8ClampedArray(B);case NX:return new Int16Array(B);case DX:return new Uint16Array(B);case PX:return new Int32Array(B);case CX:return new Uint32Array(B);case hX:return new Float32Array(B);case IX:return new Float64Array(B);default:throw new Error("Unkown type: "+Y)}}var e0={serialize:L9,deserialize:N9,stringToBuffer:SX,bufferToString:r0};function kX(V,$,Y,A){V.executeSql("CREATE TABLE IF NOT EXISTS "+$.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],Y,A)}function P9(V){var $=this,Y={db:null};if(V)for(var A in V)Y[A]=typeof V[A]!=="string"?V[A].toString():V[A];var E=new O(function(B,_){try{Y.db=openDatabase(Y.name,String(Y.version),Y.description,Y.size)}catch(U){return _(U)}Y.db.transaction(function(U){kX(U,Y,function(){$._dbInfo=Y,B()},function(x,L){_(L)})},_)});return Y.serializer=e0,E}function v1(V,$,Y,A,E,B){V.executeSql(Y,A,E,function(_,U){if(U.code===U.SYNTAX_ERR)_.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[$.storeName],function(x,L){if(!L.rows.length)kX(x,$,function(){x.executeSql(Y,A,E,B)},B);else B(x,U)},B);else B(_,U)},B)}function D9(V,$){var Y=this;V=n(V);var A=new O(function(E,B){Y.ready().then(function(){var _=Y._dbInfo;_.db.transaction(function(U){v1(U,_,"SELECT * FROM "+_.storeName+" WHERE key = ? LIMIT 1",[V],function(x,L){var N=L.rows.length?L.rows.item(0).value:null;if(N)N=_.serializer.deserialize(N);E(N)},function(x,L){B(L)})})}).catch(B)});return P(A,$),A}function C9(V,$){var Y=this,A=new O(function(E,B){Y.ready().then(function(){var _=Y._dbInfo;_.db.transaction(function(U){v1(U,_,"SELECT * FROM "+_.storeName,[],function(x,L){var N=L.rows,g=N.length;for(var c=0;c<g;c++){var a=N.item(c),r=a.value;if(r)r=_.serializer.deserialize(r);if(r=V(r,a.key,c+1),r!==void 0){E(r);return}}E()},function(x,L){B(L)})})}).catch(B)});return P(A,$),A}function fX(V,$,Y,A){var E=this;V=n(V);var B=new O(function(_,U){E.ready().then(function(){if($===void 0)$=null;var x=$,L=E._dbInfo;L.serializer.serialize($,function(N,g){if(g)U(g);else L.db.transaction(function(c){v1(c,L,"INSERT OR REPLACE INTO "+L.storeName+" (key, value) VALUES (?, ?)",[V,N],function(){_(x)},function(a,r){U(r)})},function(c){if(c.code===c.QUOTA_ERR){if(A>0){_(fX.apply(E,[V,x,Y,A-1]));return}U(c)}})})}).catch(U)});return P(B,Y),B}function h9(V,$,Y){return fX.apply(this,[V,$,Y,1])}function I9(V,$){var Y=this;V=n(V);var A=new O(function(E,B){Y.ready().then(function(){var _=Y._dbInfo;_.db.transaction(function(U){v1(U,_,"DELETE FROM "+_.storeName+" WHERE key = ?",[V],function(){E()},function(x,L){B(L)})})}).catch(B)});return P(A,$),A}function y9(V){var $=this,Y=new O(function(A,E){$.ready().then(function(){var B=$._dbInfo;B.db.transaction(function(_){v1(_,B,"DELETE FROM "+B.storeName,[],function(){A()},function(U,x){E(x)})})}).catch(E)});return P(Y,V),Y}function j9(V){var $=this,Y=new O(function(A,E){$.ready().then(function(){var B=$._dbInfo;B.db.transaction(function(_){v1(_,B,"SELECT COUNT(key) as c FROM "+B.storeName,[],function(U,x){var L=x.rows.item(0).c;A(L)},function(U,x){E(x)})})}).catch(E)});return P(Y,V),Y}function S9(V,$){var Y=this,A=new O(function(E,B){Y.ready().then(function(){var _=Y._dbInfo;_.db.transaction(function(U){v1(U,_,"SELECT key FROM "+_.storeName+" WHERE id = ? LIMIT 1",[V+1],function(x,L){var N=L.rows.length?L.rows.item(0).key:null;E(N)},function(x,L){B(L)})})}).catch(B)});return P(A,$),A}function k9(V){var $=this,Y=new O(function(A,E){$.ready().then(function(){var B=$._dbInfo;B.db.transaction(function(_){v1(_,B,"SELECT key FROM "+B.storeName,[],function(U,x){var L=[];for(var N=0;N<x.rows.length;N++)L.push(x.rows.item(N).key);A(L)},function(U,x){E(x)})})}).catch(E)});return P(Y,V),Y}function f9(V){return new O(function($,Y){V.transaction(function(A){A.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(E,B){var _=[];for(var U=0;U<B.rows.length;U++)_.push(B.rows.item(U).name);$({db:V,storeNames:_})},function(E,B){Y(B)})},function(A){Y(A)})})}function g9(V,$){$=N1.apply(this,arguments);var Y=this.config();if(V=typeof V!=="function"&&V||{},!V.name)V.name=V.name||Y.name,V.storeName=V.storeName||Y.storeName;var A=this,E;if(!V.name)E=O.reject("Invalid arguments");else E=new O(function(B){var _;if(V.name===Y.name)_=A._dbInfo.db;else _=openDatabase(V.name,"","",0);if(!V.storeName)B(f9(_));else B({db:_,storeNames:[V.storeName]})}).then(function(B){return new O(function(_,U){B.db.transaction(function(x){function L(a){return new O(function(r,Y1){x.executeSql("DROP TABLE IF EXISTS "+a,[],function(){r()},function(W1,I1){Y1(I1)})})}var N=[];for(var g=0,c=B.storeNames.length;g<c;g++)N.push(L(B.storeNames[g]));O.all(N).then(function(){_()}).catch(function(a){U(a)})},function(x){U(x)})})});return P(E,$),E}var v9={_driver:"webSQLStorage",_initStorage:P9,_support:X1(),iterate:C9,getItem:D9,setItem:h9,removeItem:I9,clear:y9,length:j9,key:S9,keys:k9,dropInstance:g9};function u9(){try{return typeof localStorage!=="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(V){return!1}}function gX(V,$){var Y=V.name+"/";if(V.storeName!==$.storeName)Y+=V.storeName+"/";return Y}function m9(){var V="_localforage_support_test";try{return localStorage.setItem(V,!0),localStorage.removeItem(V),!1}catch($){return!0}}function b9(){return!m9()||localStorage.length>0}function w9(V){var $=this,Y={};if(V)for(var A in V)Y[A]=V[A];if(Y.keyPrefix=gX(V,$._defaultConfig),!b9())return O.reject();return $._dbInfo=Y,Y.serializer=e0,O.resolve()}function p9(V){var $=this,Y=$.ready().then(function(){var A=$._dbInfo.keyPrefix;for(var E=localStorage.length-1;E>=0;E--){var B=localStorage.key(E);if(B.indexOf(A)===0)localStorage.removeItem(B)}});return P(Y,V),Y}function l9(V,$){var Y=this;V=n(V);var A=Y.ready().then(function(){var E=Y._dbInfo,B=localStorage.getItem(E.keyPrefix+V);if(B)B=E.serializer.deserialize(B);return B});return P(A,$),A}function d9(V,$){var Y=this,A=Y.ready().then(function(){var E=Y._dbInfo,B=E.keyPrefix,_=B.length,U=localStorage.length,x=1;for(var L=0;L<U;L++){var N=localStorage.key(L);if(N.indexOf(B)!==0)continue;var g=localStorage.getItem(N);if(g)g=E.serializer.deserialize(g);if(g=V(g,N.substring(_),x++),g!==void 0)return g}});return P(A,$),A}function c9(V,$){var Y=this,A=Y.ready().then(function(){var E=Y._dbInfo,B;try{B=localStorage.key(V)}catch(_){B=null}if(B)B=B.substring(E.keyPrefix.length);return B});return P(A,$),A}function n9(V){var $=this,Y=$.ready().then(function(){var A=$._dbInfo,E=localStorage.length,B=[];for(var _=0;_<E;_++){var U=localStorage.key(_);if(U.indexOf(A.keyPrefix)===0)B.push(U.substring(A.keyPrefix.length))}return B});return P(Y,V),Y}function i9(V){var $=this,Y=$.keys().then(function(A){return A.length});return P(Y,V),Y}function s9(V,$){var Y=this;V=n(V);var A=Y.ready().then(function(){var E=Y._dbInfo;localStorage.removeItem(E.keyPrefix+V)});return P(A,$),A}function t9(V,$,Y){var A=this;V=n(V);var E=A.ready().then(function(){if($===void 0)$=null;var B=$;return new O(function(_,U){var x=A._dbInfo;x.serializer.serialize($,function(L,N){if(N)U(N);else try{localStorage.setItem(x.keyPrefix+V,L),_(B)}catch(g){if(g.name==="QuotaExceededError"||g.name==="NS_ERROR_DOM_QUOTA_REACHED")U(g);U(g)}})})});return P(E,Y),E}function a9(V,$){if($=N1.apply(this,arguments),V=typeof V!=="function"&&V||{},!V.name){var Y=this.config();V.name=V.name||Y.name,V.storeName=V.storeName||Y.storeName}var A=this,E;if(!V.name)E=O.reject("Invalid arguments");else E=new O(function(B){if(!V.storeName)B(V.name+"/");else B(gX(V,A._defaultConfig))}).then(function(B){for(var _=localStorage.length-1;_>=0;_--){var U=localStorage.key(_);if(U.indexOf(B)===0)localStorage.removeItem(U)}});return P(E,$),E}var o9={_driver:"localStorageWrapper",_initStorage:w9,_support:u9(),iterate:d9,getItem:l9,setItem:t9,removeItem:s9,clear:p9,length:i9,key:c9,keys:n9,dropInstance:a9},r9=function V($,Y){return $===Y||typeof $==="number"&&typeof Y==="number"&&isNaN($)&&isNaN(Y)},e9=function V($,Y){var A=$.length,E=0;while(E<A){if(r9($[E],Y))return!0;E++}return!1},vX=Array.isArray||function(V){return Object.prototype.toString.call(V)==="[object Array]"},Q0={},uX={},a1={INDEXEDDB:C1,WEBSQL:v9,LOCALSTORAGE:o9},JQ=[a1.INDEXEDDB._driver,a1.WEBSQL._driver,a1.LOCALSTORAGE._driver],T0=["dropInstance"],JJ=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(T0),XQ={description:"",driver:JQ.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function QQ(V,$){V[$]=function(){var Y=arguments;return V.ready().then(function(){return V[$].apply(V,Y)})}}function XJ(){for(var V=1;V<arguments.length;V++){var $=arguments[V];if($){for(var Y in $)if($.hasOwnProperty(Y))if(vX($[Y]))arguments[0][Y]=$[Y].slice();else arguments[0][Y]=$[Y]}}return arguments[0]}var ZQ=function(){function V($){W(this,V);for(var Y in a1)if(a1.hasOwnProperty(Y)){var A=a1[Y],E=A._driver;if(this[Y]=E,!Q0[E])this.defineDriver(A)}this._defaultConfig=XJ({},XQ),this._config=XJ({},this._defaultConfig,$),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return V.prototype.config=function $(Y){if((typeof Y==="undefined"?"undefined":K(Y))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var A in Y){if(A==="storeName")Y[A]=Y[A].replace(/\W/g,"_");if(A==="version"&&typeof Y[A]!=="number")return new Error("Database version must be a number.");this._config[A]=Y[A]}if("driver"in Y&&Y.driver)return this.setDriver(this._config.driver);return!0}else if(typeof Y==="string")return this._config[Y];else return this._config},V.prototype.defineDriver=function $(Y,A,E){var B=new O(function(_,U){try{var x=Y._driver,L=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!Y._driver){U(L);return}var N=JJ.concat("_initStorage");for(var g=0,c=N.length;g<c;g++){var a=N[g],r=!e9(T0,a);if((r||Y[a])&&typeof Y[a]!=="function"){U(L);return}}var Y1=function I1(){var Z0=function IQ(VQ){return function(){var KQ=new Error("Method "+VQ+" is not implemented by the current driver"),mX=O.reject(KQ);return P(mX,arguments[arguments.length-1]),mX}};for(var QJ=0,HQ=T0.length;QJ<HQ;QJ++){var ZJ=T0[QJ];if(!Y[ZJ])Y[ZJ]=Z0(ZJ)}};Y1();var W1=function I1(Z0){if(Q0[x])console.info("Redefining LocalForage driver: "+x);Q0[x]=Y,uX[x]=Z0,_()};if("_support"in Y)if(Y._support&&typeof Y._support==="function")Y._support().then(W1,U);else W1(!!Y._support);else W1(!0)}catch(I1){U(I1)}});return b(B,A,E),B},V.prototype.driver=function $(){return this._driver||null},V.prototype.getDriver=function $(Y,A,E){var B=Q0[Y]?O.resolve(Q0[Y]):O.reject(new Error("Driver not found."));return b(B,A,E),B},V.prototype.getSerializer=function $(Y){var A=O.resolve(e0);return b(A,Y),A},V.prototype.ready=function $(Y){var A=this,E=A._driverSet.then(function(){if(A._ready===null)A._ready=A._initDriver();return A._ready});return b(E,Y,Y),E},V.prototype.setDriver=function $(Y,A,E){var B=this;if(!vX(Y))Y=[Y];var _=this._getSupportedDrivers(Y);function U(){B._config.driver=B.driver()}function x(g){return B._extend(g),U(),B._ready=B._initStorage(B._config),B._ready}function L(g){return function(){var c=0;function a(){while(c<g.length){var r=g[c];return c++,B._dbInfo=null,B._ready=null,B.getDriver(r).then(x).catch(a)}U();var Y1=new Error("No available storage method found.");return B._driverSet=O.reject(Y1),B._driverSet}return a()}}var N=this._driverSet!==null?this._driverSet.catch(function(){return O.resolve()}):O.resolve();return this._driverSet=N.then(function(){var g=_[0];return B._dbInfo=null,B._ready=null,B.getDriver(g).then(function(c){B._driver=c._driver,U(),B._wrapLibraryMethodsWithReady(),B._initDriver=L(_)})}).catch(function(){U();var g=new Error("No available storage method found.");return B._driverSet=O.reject(g),B._driverSet}),b(this._driverSet,A,E),this._driverSet},V.prototype.supports=function $(Y){return!!uX[Y]},V.prototype._extend=function $(Y){XJ(this,Y)},V.prototype._getSupportedDrivers=function $(Y){var A=[];for(var E=0,B=Y.length;E<B;E++){var _=Y[E];if(this.supports(_))A.push(_)}return A},V.prototype._wrapLibraryMethodsWithReady=function $(){for(var Y=0,A=JJ.length;Y<A;Y++)QQ(this,JJ[Y])},V.prototype.createInstance=function $(Y){return new V(Y)},V}(),GQ=new ZQ;G.exports=GQ},{"3":3}]},{},[4])(4)})});var H0=HJ((wX,D0)=>{((J,X)=>{if(typeof define==="function"&&define.amd)define([],X);else if(typeof D0==="object"&&wX)D0.exports=X();else J.fuzzysort=X()})(wX,(J)=>{var X=(D,R)=>{if(D=="farzher")return{target:"farzher was here (^-^*)/",score:0,_indexes:[0]};if(!D||!R)return w;var h=F(D);if(!l(R))R=z(R);var j=h.bitflags;if((j&R._bitflags)!==j)return w;return M(h,R)},Q=(D,R,h)=>{if(D=="farzher")return[{target:"farzher was here (^-^*)/",score:0,_indexes:[0],obj:R?R[0]:w}];if(!D)return h&&h.all?q(D,R,h):K1;var j=F(D),y=j.bitflags,k=j.containsSpace,f=h&&h.threshold||i,I=h&&h.limit||p,v=0,u=0,d=R.length;if(h&&h.key){var q1=h.key;for(var s=0;s<d;++s){var T1=R[s],J1=C(T1,q1);if(!J1)continue;if(!l(J1))J1=z(J1);if((y&J1._bitflags)!==y)continue;var Q1=M(j,J1);if(Q1===w)continue;if(Q1.score<f)continue;if(Q1={target:Q1.target,_targetLower:"",_targetLowerCodes:w,_nextBeginningIndexes:w,_bitflags:0,score:Q1.score,_indexes:Q1._indexes,obj:T1},v<I)H1.add(Q1),++v;else if(++u,Q1.score>H1.peek().score)H1.replaceTop(Q1)}}else if(h&&h.keys){var U0=h.scoreFn||f1,m1=h.keys,i1=m1.length;for(var s=0;s<d;++s){var T1=R[s],M1=new Array(i1);for(var C1=0;C1<i1;++C1){var q1=m1[C1],J1=C(T1,q1);if(!J1){M1[C1]=w;continue}if(!l(J1))J1=z(J1);if((y&J1._bitflags)!==y)M1[C1]=w;else M1[C1]=M(j,J1)}M1.obj=T1;var X1=U0(M1);if(X1===w)continue;if(X1<f)continue;if(M1.score=X1,v<I)H1.add(M1),++v;else if(++u,X1>H1.peek().score)H1.replaceTop(M1)}}else for(var s=0;s<d;++s){var J1=R[s];if(!J1)continue;if(!l(J1))J1=z(J1);if((y&J1._bitflags)!==y)continue;var Q1=M(j,J1);if(Q1===w)continue;if(Q1.score<f)continue;if(v<I)H1.add(Q1),++v;else if(++u,Q1.score>H1.peek().score)H1.replaceTop(Q1)}if(v===0)return K1;var _1=new Array(v);for(var s=v-1;s>=0;--s)_1[s]=H1.poll();return _1.total=v+u,_1},Z=(D,R,h)=>{if(typeof R==="function")return G(D,R);if(D===w)return w;if(R===void 0)R="<b>";if(h===void 0)h="</b>";var j="",y=0,k=!1,f=D.target,I=f.length,v=D._indexes;v=v.slice(0,v.len).sort((q1,s)=>q1-s);for(var u=0;u<I;++u){var d=f[u];if(v[y]===u){if(++y,!k)k=!0,j+=R;if(y===v.length){j+=d+h+f.substr(u+1);break}}else if(k)k=!1,j+=h;j+=d}return j},G=(u,R)=>{if(u===w)return w;var h=u.target,j=h.length,y=u._indexes;y=y.slice(0,y.len).sort((s,T1)=>s-T1);var k="",f=0,I=0,v=!1,u=[];for(var d=0;d<j;++d){var q1=h[d];if(y[I]===d){if(++I,!v)v=!0,u.push(k),k="";if(I===y.length){k+=q1,u.push(R(k,f++)),k="",u.push(h.substr(d+1));break}}else if(v)v=!1,u.push(R(k,f++)),k="";k+=q1}return u},H=(D)=>D._indexes.slice(0,D._indexes.len).sort((R,h)=>R-h),K=(D)=>{if(typeof D!=="string")D="";var R=P(D);return{target:D,_targetLower:R._lower,_targetLowerCodes:R.lowerCodes,_nextBeginningIndexes:w,_bitflags:R.bitflags,score:w,_indexes:[0],obj:w}},W=(D)=>{if(typeof D!=="string")D="";D=D.trim();var R=P(D),h=[];if(R.containsSpace){var j=D.split(/\s+/);j=[...new Set(j)];for(var y=0;y<j.length;y++){if(j[y]==="")continue;var k=P(j[y]);h.push({lowerCodes:k.lowerCodes,_lower:j[y].toLowerCase(),containsSpace:!1})}}return{lowerCodes:R.lowerCodes,bitflags:R.bitflags,containsSpace:R.containsSpace,_lower:R._lower,spaceSearches:h}},z=(D)=>{if(D.length>999)return K(D);var R=G1.get(D);if(R!==void 0)return R;return R=K(D),G1.set(D,R),R},F=(D)=>{if(D.length>999)return W(D);var R=P1.get(D);if(R!==void 0)return R;return R=W(D),P1.set(D,R),R},q=(D,R,h)=>{var j=[];j.total=R.length;var y=h&&h.limit||p;if(h&&h.key)for(var k=0;k<R.length;k++){var f=R[k],I=C(f,h.key);if(!I)continue;if(!l(I))I=z(I);I.score=i,I._indexes.len=0;var v=I;if(v={target:v.target,_targetLower:"",_targetLowerCodes:w,_nextBeginningIndexes:w,_bitflags:0,score:I.score,_indexes:w,obj:f},j.push(v),j.length>=y)return j}else if(h&&h.keys)for(var k=0;k<R.length;k++){var f=R[k],u=new Array(h.keys.length);for(var d=h.keys.length-1;d>=0;--d){var I=C(f,h.keys[d]);if(!I){u[d]=w;continue}if(!l(I))I=z(I);I.score=i,I._indexes.len=0,u[d]=I}if(u.obj=f,u.score=i,j.push(u),j.length>=y)return j}else for(var k=0;k<R.length;k++){var I=R[k];if(!I)continue;if(!l(I))I=z(I);if(I.score=i,I._indexes.len=0,j.push(I),j.length>=y)return j}return j},M=(D,R,h=!1)=>{if(h===!1&&D.containsSpace)return O(D,R);var{_lower:j,lowerCodes:y}=D,k=y[0],f=R._targetLowerCodes,I=y.length,v=f.length,s=0,u=0,d=0;for(;;){var q1=k===f[u];if(q1){if(e[d++]=u,++s,s===I)break;k=y[s]}if(++u,u>=v)return w}var s=0,T1=!1,J1=0,Q1=R._nextBeginningIndexes;if(Q1===w)Q1=R._nextBeginningIndexes=n(R.target);var U0=u=e[0]===0?0:Q1[e[0]-1],m1=0;if(u!==v)for(;;)if(u>=v){if(s<=0)break;if(++m1,m1>200)break;--s;var i1=g1[--J1];u=Q1[i1]}else{var q1=y[s]===f[u];if(q1){if(g1[J1++]=u,++s,s===I){T1=!0;break}++u}else u=Q1[u]}var M1=R._targetLower.indexOf(j,e[0]),C1=~M1;if(C1&&!T1)for(var X1=0;X1<d;++X1)e[X1]=M1+X1;var _1=!1;if(C1)_1=R._nextBeginningIndexes[M1-1]===M1;{if(T1)var h1=g1,s1=J1;else var h1=e,s1=d;var x1=0,t1=0;for(var X1=1;X1<I;++X1)if(h1[X1]-h1[X1-1]!==1)x1-=h1[X1],++t1;var X0=h1[I-1]-h1[0]-(I-1);if(x1-=(12+X0)*t1,h1[0]!==0)x1-=h1[0]*h1[0]*0.2;if(!T1)x1*=1000;else{var b1=1;for(var X1=Q1[0];X1<v;X1=Q1[X1])++b1;if(b1>24)x1*=(b1-24)*10}if(C1)x1/=1+I*I*1;if(_1)x1/=1+I*I*1;x1-=v-I,R.score=x1;for(var X1=0;X1<s1;++X1)R._indexes[X1]=h1[X1];return R._indexes.len=s1,R}},O=(D,R)=>{var h=new Set,j=0,y=w,k=0,f=D.spaceSearches;for(var d=0;d<f.length;++d){var I=f[d];if(y=M(I,R),y===w)return w;if(j+=y.score,y._indexes[0]<k)j-=k-y._indexes[0];k=y._indexes[0];for(var v=0;v<y._indexes.len;++v)h.add(y._indexes[v])}var u=M(D,R,!0);if(u!==w&&u.score>j)return u;y.score=j;var d=0;for(let q1 of h)y._indexes[d++]=q1;return y._indexes.len=d,y},P=(D)=>{var R=D.length,h=D.toLowerCase(),j=[],y=0,k=!1;for(var f=0;f<R;++f){var I=j[f]=h.charCodeAt(f);if(I===32){k=!0;continue}var v=I>=97&&I<=122?I-97:I>=48&&I<=57?26:I<=127?30:31;y|=1<<v}return{lowerCodes:j,bitflags:y,containsSpace:k,_lower:h}},b=(D)=>{var R=D.length,h=[],j=0,y=!1,k=!1;for(var f=0;f<R;++f){var I=D.charCodeAt(f),v=I>=65&&I<=90,u=v||I>=97&&I<=122||I>=48&&I<=57,d=v&&!y||!k||!u;if(y=v,k=u,d)h[j++]=f}return h},n=(D)=>{var R=D.length,h=b(D),j=[],y=h[0],k=0;for(var f=0;f<R;++f)if(y>f)j[f]=y;else y=h[++k],j[f]=y===void 0?R:y;return j},N1=()=>{G1.clear(),P1.clear(),e=[],g1=[]},G1=new Map,P1=new Map,e=[],g1=[],f1=(D)=>{var R=i,h=D.length;for(var j=0;j<h;++j){var y=D[j];if(y===w)continue;var k=y.score;if(k>R)R=k}if(R===i)return w;return R},C=(D,R)=>{var h=D[R];if(h!==void 0)return h;var j=R;if(!Array.isArray(R))j=R.split(".");var y=j.length,k=-1;while(D&&++k<y)D=D[j[k]];return D},l=(D)=>{return typeof D==="object"},p=Infinity,i=-p,K1=[];K1.total=0;var w=null,U1=(D)=>{var R=[],h=0,j={},y=(k)=>{for(var f=0,I=R[f],v=1;v<h;){var u=v+1;f=v,u<h&&R[u].score<R[v].score&&(f=u),R[f-1>>1]=R[f],v=1+(f<<1)}for(var d=f-1>>1;f>0&&I.score<R[d].score;d=(f=d)-1>>1)R[f]=R[d];R[f]=I};return j.add=(k)=>{var f=h;R[h++]=k;for(var I=f-1>>1;f>0&&k.score<R[I].score;I=(f=I)-1>>1)R[f]=R[I];R[f]=k},j.poll=(k)=>{if(h!==0){var f=R[0];return R[0]=R[--h],y(),f}},j.peek=(k)=>{if(h!==0)return R[0]},j.replaceTop=(k)=>{R[0]=k,y()},j},H1=U1();return{single:X,go:Q,highlight:Z,prepare:K,indexes:H,cleanup:N1}})});var $X=HJ((N5,zX)=>{var T={};T.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)};T.localCName=T.generateIdentifier();T.splitLines=function(J){return J.trim().split("\n").map((X)=>X.trim())};T.splitSections=function(J){return J.split("\nm=").map((Q,Z)=>(Z>0?"m="+Q:Q).trim()+"\r\n")};T.getDescription=function(J){const X=T.splitSections(J);return X&&X[0]};T.getMediaSections=function(J){const X=T.splitSections(J);return X.shift(),X};T.matchPrefix=function(J,X){return T.splitLines(J).filter((Q)=>Q.indexOf(X)===0)};T.parseCandidate=function(J){let X;if(J.indexOf("a=candidate:")===0)X=J.substring(12).split(" ");else X=J.substring(10).split(" ");const Q={foundation:X[0],component:{1:"rtp",2:"rtcp"}[X[1]]||X[1],protocol:X[2].toLowerCase(),priority:parseInt(X[3],10),ip:X[4],address:X[4],port:parseInt(X[5],10),type:X[7]};for(let Z=8;Z<X.length;Z+=2)switch(X[Z]){case"raddr":Q.relatedAddress=X[Z+1];break;case"rport":Q.relatedPort=parseInt(X[Z+1],10);break;case"tcptype":Q.tcpType=X[Z+1];break;case"ufrag":Q.ufrag=X[Z+1],Q.usernameFragment=X[Z+1];break;default:if(Q[X[Z]]===void 0)Q[X[Z]]=X[Z+1];break}return Q};T.writeCandidate=function(J){const X=[];X.push(J.foundation);const Q=J.component;if(Q==="rtp")X.push(1);else if(Q==="rtcp")X.push(2);else X.push(Q);X.push(J.protocol.toUpperCase()),X.push(J.priority),X.push(J.address||J.ip),X.push(J.port);const Z=J.type;if(X.push("typ"),X.push(Z),Z!=="host"&&J.relatedAddress&&J.relatedPort)X.push("raddr"),X.push(J.relatedAddress),X.push("rport"),X.push(J.relatedPort);if(J.tcpType&&J.protocol.toLowerCase()==="tcp")X.push("tcptype"),X.push(J.tcpType);if(J.usernameFragment||J.ufrag)X.push("ufrag"),X.push(J.usernameFragment||J.ufrag);return"candidate:"+X.join(" ")};T.parseIceOptions=function(J){return J.substring(14).split(" ")};T.parseRtpMap=function(J){let X=J.substring(9).split(" ");const Q={payloadType:parseInt(X.shift(),10)};return X=X[0].split("/"),Q.name=X[0],Q.clockRate=parseInt(X[1],10),Q.channels=X.length===3?parseInt(X[2],10):1,Q.numChannels=Q.channels,Q};T.writeRtpMap=function(J){let X=J.payloadType;if(J.preferredPayloadType!==void 0)X=J.preferredPayloadType;const Q=J.channels||J.numChannels||1;return"a=rtpmap:"+X+" "+J.name+"/"+J.clockRate+(Q!==1?"/"+Q:"")+"\r\n"};T.parseExtmap=function(J){const X=J.substring(9).split(" ");return{id:parseInt(X[0],10),direction:X[0].indexOf("/")>0?X[0].split("/")[1]:"sendrecv",uri:X[1],attributes:X.slice(2).join(" ")}};T.writeExtmap=function(J){return"a=extmap:"+(J.id||J.preferredId)+(J.direction&&J.direction!=="sendrecv"?"/"+J.direction:"")+" "+J.uri+(J.attributes?" "+J.attributes:"")+"\r\n"};T.parseFmtp=function(J){const X={};let Q;const Z=J.substring(J.indexOf(" ")+1).split(";");for(let G=0;G<Z.length;G++)Q=Z[G].trim().split("="),X[Q[0].trim()]=Q[1];return X};T.writeFmtp=function(J){let X="",Q=J.payloadType;if(J.preferredPayloadType!==void 0)Q=J.preferredPayloadType;if(J.parameters&&Object.keys(J.parameters).length){const Z=[];Object.keys(J.parameters).forEach((G)=>{if(J.parameters[G]!==void 0)Z.push(G+"="+J.parameters[G]);else Z.push(G)}),X+="a=fmtp:"+Q+" "+Z.join(";")+"\r\n"}return X};T.parseRtcpFb=function(J){const X=J.substring(J.indexOf(" ")+1).split(" ");return{type:X.shift(),parameter:X.join(" ")}};T.writeRtcpFb=function(J){let X="",Q=J.payloadType;if(J.preferredPayloadType!==void 0)Q=J.preferredPayloadType;if(J.rtcpFeedback&&J.rtcpFeedback.length)J.rtcpFeedback.forEach((Z)=>{X+="a=rtcp-fb:"+Q+" "+Z.type+(Z.parameter&&Z.parameter.length?" "+Z.parameter:"")+"\r\n"});return X};T.parseSsrcMedia=function(J){const X=J.indexOf(" "),Q={ssrc:parseInt(J.substring(7,X),10)},Z=J.indexOf(":",X);if(Z>-1)Q.attribute=J.substring(X+1,Z),Q.value=J.substring(Z+1);else Q.attribute=J.substring(X+1);return Q};T.parseSsrcGroup=function(J){const X=J.substring(13).split(" ");return{semantics:X.shift(),ssrcs:X.map((Q)=>parseInt(Q,10))}};T.getMid=function(J){const X=T.matchPrefix(J,"a=mid:")[0];if(X)return X.substring(6)};T.parseFingerprint=function(J){const X=J.substring(14).split(" ");return{algorithm:X[0].toLowerCase(),value:X[1].toUpperCase()}};T.getDtlsParameters=function(J,X){return{role:"auto",fingerprints:T.matchPrefix(J+X,"a=fingerprint:").map(T.parseFingerprint)}};T.writeDtlsParameters=function(J,X){let Q="a=setup:"+X+"\r\n";return J.fingerprints.forEach((Z)=>{Q+="a=fingerprint:"+Z.algorithm+" "+Z.value+"\r\n"}),Q};T.parseCryptoLine=function(J){const X=J.substring(9).split(" ");return{tag:parseInt(X[0],10),cryptoSuite:X[1],keyParams:X[2],sessionParams:X.slice(3)}};T.writeCryptoLine=function(J){return"a=crypto:"+J.tag+" "+J.cryptoSuite+" "+(typeof J.keyParams==="object"?T.writeCryptoKeyParams(J.keyParams):J.keyParams)+(J.sessionParams?" "+J.sessionParams.join(" "):"")+"\r\n"};T.parseCryptoKeyParams=function(J){if(J.indexOf("inline:")!==0)return null;const X=J.substring(7).split("|");return{keyMethod:"inline",keySalt:X[0],lifeTime:X[1],mkiValue:X[2]?X[2].split(":")[0]:void 0,mkiLength:X[2]?X[2].split(":")[1]:void 0}};T.writeCryptoKeyParams=function(J){return J.keyMethod+":"+J.keySalt+(J.lifeTime?"|"+J.lifeTime:"")+(J.mkiValue&&J.mkiLength?"|"+J.mkiValue+":"+J.mkiLength:"")};T.getCryptoParameters=function(J,X){return T.matchPrefix(J+X,"a=crypto:").map(T.parseCryptoLine)};T.getIceParameters=function(J,X){const Q=T.matchPrefix(J+X,"a=ice-ufrag:")[0],Z=T.matchPrefix(J+X,"a=ice-pwd:")[0];if(!(Q&&Z))return null;return{usernameFragment:Q.substring(12),password:Z.substring(10)}};T.writeIceParameters=function(J){let X="a=ice-ufrag:"+J.usernameFragment+"\r\na=ice-pwd:"+J.password+"\r\n";if(J.iceLite)X+="a=ice-lite\r\n";return X};T.parseRtpParameters=function(J){const X={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},Z=T.splitLines(J)[0].split(" ");X.profile=Z[2];for(let H=3;H<Z.length;H++){const K=Z[H],W=T.matchPrefix(J,"a=rtpmap:"+K+" ")[0];if(W){const z=T.parseRtpMap(W),F=T.matchPrefix(J,"a=fmtp:"+K+" ");switch(z.parameters=F.length?T.parseFmtp(F[0]):{},z.rtcpFeedback=T.matchPrefix(J,"a=rtcp-fb:"+K+" ").map(T.parseRtcpFb),X.codecs.push(z),z.name.toUpperCase()){case"RED":case"ULPFEC":X.fecMechanisms.push(z.name.toUpperCase());break;default:break}}}T.matchPrefix(J,"a=extmap:").forEach((H)=>{X.headerExtensions.push(T.parseExtmap(H))});const G=T.matchPrefix(J,"a=rtcp-fb:* ").map(T.parseRtcpFb);return X.codecs.forEach((H)=>{G.forEach((K)=>{if(!H.rtcpFeedback.find((z)=>{return z.type===K.type&&z.parameter===K.parameter}))H.rtcpFeedback.push(K)})}),X};T.writeRtpDescription=function(J,X){let Q="";Q+="m="+J+" ",Q+=X.codecs.length>0?"9":"0",Q+=" "+(X.profile||"UDP/TLS/RTP/SAVPF")+" ",Q+=X.codecs.map((G)=>{if(G.preferredPayloadType!==void 0)return G.preferredPayloadType;return G.payloadType}).join(" ")+"\r\n",Q+="c=IN IP4 0.0.0.0\r\n",Q+="a=rtcp:9 IN IP4 0.0.0.0\r\n",X.codecs.forEach((G)=>{Q+=T.writeRtpMap(G),Q+=T.writeFmtp(G),Q+=T.writeRtcpFb(G)});let Z=0;if(X.codecs.forEach((G)=>{if(G.maxptime>Z)Z=G.maxptime}),Z>0)Q+="a=maxptime:"+Z+"\r\n";if(X.headerExtensions)X.headerExtensions.forEach((G)=>{Q+=T.writeExtmap(G)});return Q};T.parseRtpEncodingParameters=function(J){const X=[],Q=T.parseRtpParameters(J),Z=Q.fecMechanisms.indexOf("RED")!==-1,G=Q.fecMechanisms.indexOf("ULPFEC")!==-1,H=T.matchPrefix(J,"a=ssrc:").map((q)=>T.parseSsrcMedia(q)).filter((q)=>q.attribute==="cname"),K=H.length>0&&H[0].ssrc;let W;const z=T.matchPrefix(J,"a=ssrc-group:FID").map((q)=>{return q.substring(17).split(" ").map((O)=>parseInt(O,10))});if(z.length>0&&z[0].length>1&&z[0][0]===K)W=z[0][1];if(Q.codecs.forEach((q)=>{if(q.name.toUpperCase()==="RTX"&&q.parameters.apt){let M={ssrc:K,codecPayloadType:parseInt(q.parameters.apt,10)};if(K&&W)M.rtx={ssrc:W};if(X.push(M),Z)M=JSON.parse(JSON.stringify(M)),M.fec={ssrc:K,mechanism:G?"red+ulpfec":"red"},X.push(M)}}),X.length===0&&K)X.push({ssrc:K});let F=T.matchPrefix(J,"b=");if(F.length){if(F[0].indexOf("b=TIAS:")===0)F=parseInt(F[0].substring(7),10);else if(F[0].indexOf("b=AS:")===0)F=parseInt(F[0].substring(5),10)*1000*0.95-16000;else F=void 0;X.forEach((q)=>{q.maxBitrate=F})}return X};T.parseRtcpParameters=function(J){const X={},Q=T.matchPrefix(J,"a=ssrc:").map((H)=>T.parseSsrcMedia(H)).filter((H)=>H.attribute==="cname")[0];if(Q)X.cname=Q.value,X.ssrc=Q.ssrc;const Z=T.matchPrefix(J,"a=rtcp-rsize");X.reducedSize=Z.length>0,X.compound=Z.length===0;const G=T.matchPrefix(J,"a=rtcp-mux");return X.mux=G.length>0,X};T.writeRtcpParameters=function(J){let X="";if(J.reducedSize)X+="a=rtcp-rsize\r\n";if(J.mux)X+="a=rtcp-mux\r\n";if(J.ssrc!==void 0&&J.cname)X+="a=ssrc:"+J.ssrc+" cname:"+J.cname+"\r\n";return X};T.parseMsid=function(J){let X;const Q=T.matchPrefix(J,"a=msid:");if(Q.length===1)return X=Q[0].substring(7).split(" "),{stream:X[0],track:X[1]};const Z=T.matchPrefix(J,"a=ssrc:").map((G)=>T.parseSsrcMedia(G)).filter((G)=>G.attribute==="msid");if(Z.length>0)return X=Z[0].value.split(" "),{stream:X[0],track:X[1]}};T.parseSctpDescription=function(J){const X=T.parseMLine(J),Q=T.matchPrefix(J,"a=max-message-size:");let Z;if(Q.length>0)Z=parseInt(Q[0].substring(19),10);if(isNaN(Z))Z=65536;const G=T.matchPrefix(J,"a=sctp-port:");if(G.length>0)return{port:parseInt(G[0].substring(12),10),protocol:X.fmt,maxMessageSize:Z};const H=T.matchPrefix(J,"a=sctpmap:");if(H.length>0){const K=H[0].substring(10).split(" ");return{port:parseInt(K[0],10),protocol:K[1],maxMessageSize:Z}}};T.writeSctpDescription=function(J,X){let Q=[];if(J.protocol!=="DTLS/SCTP")Q=["m="+J.kind+" 9 "+J.protocol+" "+X.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+X.port+"\r\n"];else Q=["m="+J.kind+" 9 "+J.protocol+" "+X.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+X.port+" "+X.protocol+" 65535\r\n"];if(X.maxMessageSize!==void 0)Q.push("a=max-message-size:"+X.maxMessageSize+"\r\n");return Q.join("")};T.generateSessionId=function(){return Math.random().toString().substr(2,22)};T.writeSessionBoilerplate=function(J,X,Q){let Z;const G=X!==void 0?X:2;if(J)Z=J;else Z=T.generateSessionId();return"v=0\r\no="+(Q||"thisisadapterortc")+" "+Z+" "+G+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};T.getDirection=function(J,X){const Q=T.splitLines(J);for(let Z=0;Z<Q.length;Z++)switch(Q[Z]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return Q[Z].substring(2);default:}if(X)return T.getDirection(X);return"sendrecv"};T.getKind=function(J){return T.splitLines(J)[0].split(" ")[0].substring(2)};T.isRejected=function(J){return J.split(" ",2)[1]==="0"};T.parseMLine=function(J){const Q=T.splitLines(J)[0].substring(2).split(" ");return{kind:Q[0],port:parseInt(Q[1],10),protocol:Q[2],fmt:Q.slice(3).join(" ")}};T.parseOLine=function(J){const Q=T.matchPrefix(J,"o=")[0].substring(2).split(" ");return{username:Q[0],sessionId:Q[1],sessionVersion:parseInt(Q[2],10),netType:Q[3],addressType:Q[4],address:Q[5]}};T.isValidSDP=function(J){if(typeof J!=="string"||J.length===0)return!1;const X=T.splitLines(J);for(let Q=0;Q<X.length;Q++)if(X[Q].length<2||X[Q].charAt(1)!=="=")return!1;return!0};if(typeof zX==="object")zX.exports=T});var Y0=u1(KJ(),1);function L0(J){if(typeof J!=="number")return(X)=>X;return(X)=>{if(typeof X!=="number")return X;return X+J}}function N0(J){return(X)=>{if(!Array.isArray(X))return X;if(X.findIndex((Z)=>Bun.deepEquals(Z,J,!0))===-1)X.push(J);return X}}function P0(J){return(X)=>{if(!Array.isArray(X))return X;const Q=X.findIndex((Z)=>Bun.deepEquals(Z,J,!0));if(Q!==-1)X.splice(Q,1);return X}}var WJ=u1(KJ(),1);function YJ(J){if(!J)return this.userErrors.push("No collection name specified in collection() method."),this;else if(typeof J!=="string")return this.userErrors.push("Collection name in collection() method must be a string and not an object, number or boolean."),this;else{this.collectionName=J;let X=this.dbName;if(!(J in this.lf))this.lf[J]=WJ.default.createInstance({driver:WJ.default.INDEXEDDB,name:X,storeName:J});return this}}function zJ(J){if(!J)this.userErrors.push("No document criteria specified in doc() method. Use a string (with a key) or an object (with criteria) e.g. { id: 1 }");else if(typeof J!=="string"&&typeof J!=="object")this.userErrors.push("Document criteria specified in doc() method must not be a number or boolean. Use a string (with a key) or an object (with criteria) e.g. { id: 1 }");else this.docSelectionCriteria=J;return this}function $J(J,X){if(!J)this.userErrors.push("No field name specified in orderBy() method. Use a string e.g. 'name'");else if(typeof J!=="string")this.userErrors.push("First parameter in orderBy() method must be a string (a field name) e.g. 'name'");else this.orderByProperty=J;if(X)if(X!=="asc"&&X!=="desc")this.userErrors.push("Second parameter in orderBy() method must be a string set to 'asc' or 'desc'.");else this.orderByDirection=X;return this}function FJ(J){if(!J)this.userErrors.push("No integer specified in limit() method.");else if(!Number.isInteger(J))this.userErrors.push("Limit parameter in limit() method must be an integer (e.g. 3) and not a float, boolean, string or object.");else this.limitBy=J;return this}function BJ(J,X,Q=!1,Z=!1){if(!J||typeof J!=="string")return this.userErrors.push("Propiedad no valida"),this;else if(typeof X!=="boolean"&&typeof X!=="string"&&typeof X!=="number")this.userErrors.push("Valor a buscar no es valido");else return this.containsProperty=J,this.containsValue=X,this.containsExact=Q,this.containsSinError=Z,this}function y1(J,X){return Object.keys(X).every((Q)=>{if(typeof X[Q]=="object")return y1(J[Q],X[Q]);return X[Q]===J[Q]})}var w1={baseStyle:`
    padding: 2px 5px;
    background-color: #124F5C;
    border-radius: 4px;
    color: white; 
  `,colors:{log:"#124F5C",error:"#ed2939",warn:"#f39c12"},log(J,X){if(this.config.debug){let Q=w1.baseStyle+`background-color: ${w1.colors.log}`;if(X)console.log("%cLocalbase",Q,J,X);else console.log("%cLocalbase",Q,J)}},error(J,X){if(this.config.debug){let Q=w1.baseStyle+`background-color: ${w1.colors.error}`;console.error("%cLocalbase",Q,J)}},warn(J,X){if(this.config.debug){let Q=w1.baseStyle+`background-color: ${w1.colors.warn}`;console.warn("%cLocalbase",Q,J)}}},Z1=w1;function E1(){this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.userErrors=[],this.whereArguments=[],this.currentPage=0,this.porPag=Infinity,this.whereCount=0}function D1(){let J;if(!this.collectionName&&!this.docSelectionCriteria)J="db";else if(this.collectionName&&!this.docSelectionCriteria)J="collection";else if(this.collectionName&&this.docSelectionCriteria)J="doc";return J}function $1(){for(let J=0;J<this.userErrors.length;J++)Z1.error.call(this,this.userErrors[J]);E1.call(this)}var lX=u1(H0(),1),pX=function(J,X){return typeof J==="string"&&typeof X==="string"},FQ=function(J,X){try{for(let[Q,Z]of Object.entries(X))switch(!0){case(Q.endsWith("_eq")||!Q.includes("_")):if(J[Q.replace("_eq","")]!==Z)return!1;break;case Q.endsWith("_lt"):if(!(J[Q.replace("_lt","")]<Z))return!1;break;case Q.endsWith("_gt"):if(!(J[Q.replace("_gt","")]>Z))return!1;break;case Q.endsWith("_lte"):if(!(J[Q.replace("_lte","")]<=Z))return!1;break;case Q.endsWith("_gte"):if(!(J[Q.replace("_gte","")]>=Z))return!1;break;case Q.endsWith("_contains"):if(pX(J[Q.replace("_contains","")],Z)){if(!String(J[Q.replace("_contains","")]).toLowerCase().includes(Z.toLowerCase()))return!1}else if(!J[Q.replace("_contains","")].includes(Z))return!1;break;case Q.endsWith("_search"):if(pX(J[Q.replace("_search","")],Z)){const W=String(J[Q.replace("_search","")]).toLowerCase();if(!lX.single(Z.toLowerCase(),W))return!1}else if(!J[Q.replace("_search","")].includes(Z))return!1;break;case Q.endsWith("_startsWith"):if(!J[Q.replace("_startsWith","")].startsWith(Z))return!1;break;case Q.endsWith("_endsWith"):if(!J[Q.replace("_endsWith","")].endsWith(Z))return!1;break;case Q.endsWith("_in"):if(!Z.includes(J[Q.replace("_in","")]))return!1;break;case Q.endsWith("_nin"):if(Z.includes(J[Q.replace("_nin","")]))return!1;break;case Q.endsWith("_neq"):if(J[Q.replace("_neq","")]===Z)return!1;break;case Q.endsWith("_null"):if(J[Q.replace("_null","")]!==null)return!1;break;case Q.endsWith("_notNull"):if(J[Q.replace("_notNull","")]===null)return!1;break;case Q.endsWith("_between"):const[G,H]=Z,K=J[Q.replace("_between","")];if(K<G||K>H)return!1;break;default:break}return!0}catch(Q){return!1}};function p1(J){if(this.whereCount===0)return!0;for(let X of this.whereArguments)if(FQ(J,X))return!0}function C0(J,X){return m.cache[J][X]}function l1(J,X){if(!m.cache[J])return!1;return m.cache[J][X]?!0:!1}async function V0({db:J,collectionName:X,lf:Q},Z){if(!J||!X)throw new Error("db y collectionName son requeridos");if(!Q)throw new Error("lf es requerido");if(!Z)throw new Error("callback es requerido");if(typeof Z!=="function")throw new Error("callback debe ser una funci\xF3n");if(l1(J,X)){const H=C0(J,X);for(let K of H)Z(K,K._id);return}const G=await AJ(J,X,Q);for(let H of G)Z(H,H._id)}async function AJ(J,X,Q){if(!m.cache[J])m.cache[J]={};if(!m.cache[J][X])m.cache[J][X]=[];return m.cache[J][X]=[],await Q[X].iterate(function(Z,G){m.cache[J][X].push(Z)}),m.cache[J][X]}function qJ(J={keys:!1}){if(this.getCollection=()=>{let X=this.collectionName,Q=this.orderByProperty,Z=this.orderByDirection,G=this.limitBy,H=this.currentPage,K=this.porPag,W,z=[];return V0({db:this.dbName,collectionName:X,lf:this.lf},(F,q)=>{const M=F.data||F;let O={};if(!J.keys)O=this.noChange?F:M;else O={key:q,data:this.noChange?F:M};if(W=`Got "${X}" collection`,typeof M==="object")p1.call(this,M)&&z.push(O)}).then(()=>{if(Q)if(W+=`, ordered by "${Q}"`,!J.keys)z.sort((F,q)=>{return this.noChange?F.data[Q].toString().localeCompare(q.data[Q].toString()):F[Q].toString().localeCompare(q[Q].toString())});else z.sort((F,q)=>{return this.noChange?F.data.data[Q].toString().localeCompare(q.data.data[Q].toString()):F.data[Q].toString().localeCompare(q.data[Q].toString())});if(Z=="desc")W+=" (descending)",z.reverse();if(K<Infinity){let F=(H-1)*K,q=F+K;z=z.slice(F,q),W+=`, page ${H}`}if(G)W+=`, limited to ${G}`,z=z.splice(0,G);return W+=":",Z1.log.call(this,W,z),E1.call(this),z})},this.getDocument=()=>{let X=this.collectionName,Q=this.docSelectionCriteria,Z=[],G={};if(this.getDocumentByCriteria=()=>{return V0({db:this.dbName,collectionName:X,lf:this.lf},(H,K)=>{const W=this.noChange?H:H.data||H;if(y1(W,Q))Z.push(W)}).then(()=>{if(!Z.length)Z1.error.call(this,`Could not find Document in "${X}" collection with criteria: ${JSON.stringify(Q)}`);else return G=Z[0],Z1.log.call(this,`Got Document with ${JSON.stringify(Q)}:`,G),E1.call(this),G})},this.getDocumentByKey=()=>{return this.lf[X].getItem(Q).then((H)=>{if(G=this.noChange?H:H.data||H,G)Z1.log.call(this,`Got Document with key ${JSON.stringify(Q)}:`,G);else Z1.error.call(this,`Could not find Document in "${X}" collection with Key: ${JSON.stringify(Q)}`);return E1.call(this),G}).catch((H)=>{Z1.error.call(this,`Could not find Document in "${X}" collection with Key: ${JSON.stringify(Q)}`),E1.call(this)})},typeof Q=="object")return this.getDocumentByCriteria();else return this.getDocumentByKey()},!(typeof J=="object"&&J instanceof Array==!1))this.userErrors.push('Data passed to .get() must be an object. Not an array, string, number or boolean. The object must contain a "keys" property set to true or false, e.g. { keys: true }');else if(!J.hasOwnProperty("keys"))this.userErrors.push('Object passed to get() method must contain a "keys" property set to boolean true or false, e.g. { keys: true }');else if(typeof J.keys!=="boolean")this.userErrors.push('Property "keys" passed into get() method must be assigned a boolean value (true or false). Not a string or integer.');if(!this.userErrors.length){let X=D1.call(this);if(X=="collection")return this.getCollection();else if(X=="doc")return this.getDocument()}else return $1.call(this),null}function B1(J,X){return E1.call(this),Z1.log.call(this,J,X),{success:!0,message:J,data:X}}function z1(J){return E1.call(this),Z1.error.call(this,J),`Error: ${J}`}var dX=u1(H0(),1);function K0(J){let X=[];Object.keys(J).forEach(async(Z)=>{if(typeof J[Z]==="string"&&J[Z].length<200){if(isNaN(Number(J[Z])))X.push(Z)}});let Q="";return X.forEach((Z)=>Q+=`${J[Z]} `),Q.trimEnd()}var t={ADD:"add",DELETE:"delete",UPDATE:"update",SET:"set",DROP:"drop",GET:"get",GET_ALL:"getAll",GET_WHERE:"getWhere",SEARCH:"search",COUNT:"count"};function EJ(J,X){if(!J)this.userErrors.push('No data specified in add() method. You must use an object, e.g { id: 1, name: "Bill", age: 47 }');else if(!(typeof J=="object"&&J instanceof Array==!1))this.userErrors.push("Data passed to .add() must be an object. Not an array, string, number or boolean.");if(!this.userErrors.length){let Q=this.collectionName;return new Promise((Z,G)=>{let H=null;const K={};if(!X)H=this.uid();else H=X;try{if(J._prepared_===void 0)K._prepared_=dX.prepare(K0(J));else K._prepared_=J._prepared_,delete J._prepared_}catch(z){Z1.error.call(this,z.message)}const W=Date.now();if(K.createdAt=J.createdAt||W,K.updatedAt=J.updatedAt||W,K._id=J._id||H,K._nodeId=J._nodeId||this.nodeId,delete J._nodeId,delete J._id,delete J.createdAt,delete J.updatedAt,this.nodeId){if(J.clock)K.clock=J.clock,delete J.clock;if(!K.clock)K.clock={[this.nodeId]:0};if(!K.clock[this.nodeId])K.clock[this.nodeId]=0}if(J.data)K.data=J.data,delete J.data;else K.data=J;if(!K.data.id)K.data.id=H;return this.lf[Q].setItem(H,K).then(async()=>{this.change(Q,t.ADD,K,H),Z(B1.call(this,`Document added to "${Q}" collection.`,{key:H,data:J}))}).catch((z)=>{G(z1.call(this,`Could not add Document to ${Q} collection.`))})})}else $1.call(this)}function W0(J){for(let X=1;X<arguments.length;X++)for(let Q in arguments[X]){const Z=arguments[X][Q];J[Q]=Z}return J}var BQ=L0(1).toString(),AQ=N0({}).toString(),qQ=P0({}).toString(),EQ=(J,X,Q)=>{const Z=JSON.parse(JSON.stringify(Q));if(Z[J]===void 0)Z[J]=0;const G=Z[J];return X(G)},OQ=(J,X,Q)=>{const Z=JSON.parse(JSON.stringify(Q));if(Z[J]===void 0)Z[J]=[];const G=Z[J];return X(G)};function h0(J,X){try{for(let Q in J)if(J.hasOwnProperty(Q)&&typeof J[Q]==="function"){const Z=J[Q].toString();if(Z===BQ)J[Q]=EQ(Q,J[Q],X);else if(Z===AQ||Z===qQ)J[Q]=OQ(Q,J[Q],X);else throw new Error(`La propiedad ${Q} es una funci\xF3n pero no es Localbase.increment, Localbase.arrayUnion o Localbase.arrayRemove`)}return J}catch(Q){throw new Error(`Error en la funci\xF3n validarYEjecutarFunciones: ${Q.message}`)}}function I0(J,X){if(J.updatedAt<X.updatedAt)return-1;else if(J.updatedAt>X.updatedAt)return 1;else{const Q=J.clock||{},Z=X.clock||{};let G=!1,H=!1;for(let K in Q)if(Q[K]>(Z[K]||0))G=!0;else if(Q[K]<(Z[K]||0))H=!0;if(G&&!H)return-1;else if(!G&&H)return 1;else if(J._nodeId&&X._nodeId)return J._nodeId.localeCompare(X._nodeId);else return 0}}var cX=u1(H0(),1);function OJ(J){let X=this.collectionName,Q=this.docSelectionCriteria,Z=this.nodeId,G=this.whereCount;return new Promise((H,K)=>{if(this.actualizarDataDefault=(W)=>{if(W.updatedAt=Date.now(),W._prepared_)W._prepared_=cX.prepare(K0(W.data));if(Z){if(W.nodeId=Z,W.clock)if(W.clock[Z])W.clock[Z]++;else W.clock[Z]=1}return W},this.updateDocumentByCriteria=()=>{let W=[];this.lf[X].iterate((z,F)=>{const q=JSON.parse(JSON.stringify(z)),M=JSON.parse(JSON.stringify(z.data||{})),O=h0.call(this,J,M);if(G===0){if(y1(O,Q)){const P=W0(M,O),b=this.actualizarDataDefault({...q,data:P});W.push({key:F,newDocument:b,oldDocument:q})}}else if(p1.call(this,M)){const P=W0(M,O),b=this.actualizarDataDefault({...q,data:P});W.push({key:F,newDocument:b,oldDocument:q})}}).then(()=>{if(!W.length)K(z1.call(this,`No Documents found in ${X} Collection with criteria ${JSON.stringify(Q)}.`));if(W.length>1)Z1.warn.call(this,`Multiple documents (${W.length}) with ${JSON.stringify(Q)} found for updating.`)}).then(()=>{W.forEach((z,F)=>{this.lf[X].setItem(z.key,z.newDocument).then((q)=>{if(this.change(X,t.UPDATE,{...z},z.key),F===W.length-1)H(B1.call(this,`${W.length} Document${W.length>1?"s":""} in "${X}" collection with ${JSON.stringify(Q)} updated.`,J))}).catch((q)=>{K(z1.call(this,`Could not update ${W.length} Documents in ${X} Collection.`))})})})},this.updateDocumentByKey=()=>{let W={key:Q};this.lf[X].getItem(Q).then((z)=>{W.oldDocument=JSON.parse(JSON.stringify(z));const F=JSON.parse(JSON.stringify(z.data||{})),q=h0.call(this,J,F);W.newDocument=this.actualizarDataDefault({...z,data:W0(F,q)}),this.lf[X].setItem(Q,W.newDocument),this.change(X,t.UPDATE,W,W.key),H(B1.call(this,`Document in "${X}" collection with key ${JSON.stringify(Q)} updated.`,W.newDocument))}).catch((z)=>{K(z1.call(this,`No Document found in "${X}" collection with key ${JSON.stringify(Q)}`))})},this.updateDocumentByKeyCloud=()=>{let W={key:Q};this.lf[X].getItem(Q).then((z)=>{if(J.clock)if(J.clock[Z])J.clock[Z]++;else J.clock[Z]=1;const q=[z,J].reduce((M,O)=>{return I0(M,O)>0?M:O});q.nodeId=Z,W.oldDocument=JSON.parse(JSON.stringify(z)),W.newDocument=JSON.parse(JSON.stringify(q)),this.lf[X].setItem(Q,W.newDocument),this.change(X,t.UPDATE,W,W.key),H(B1.call(this,`Document in "${X}" collection with key ${JSON.stringify(Q)} updated.`,W.newDocument))}).catch((z)=>{K(z1.call(this,`No Document found in "${X}" collection with key ${JSON.stringify(Q)}`))})},!J)this.userErrors.push('No update object provided to update() method. Use an object e.g. { name: "William" }');else if(!(typeof J=="object"&&J instanceof Array==!1))this.userErrors.push("Data passed to .update() must be an object. Not an array, string, number or boolean.");if(!this.userErrors.length)if(typeof Q=="object"){if(Q!==null||this.whereCount>0)this.updateDocumentByCriteria()}else if(this.noChange)this.updateDocumentByKeyCloud();else this.updateDocumentByKey();else $1.call(this)})}function MJ(J,X={keys:!1}){let Q=this.collectionName,Z=this.docSelectionCriteria,G=D1.call(this);return new Promise((H,K)=>{if(this.setCollection=()=>{this.lf[Q].clear().then(()=>{if(!X.keys)J.forEach((W)=>{this.add(W)}),H(B1.call(this,`Collection "${Q}" set with ${J.length} Documents.`,J));else{let W=0;if(J.forEach((z)=>{if(!z.hasOwnProperty("_key"))W++}),W)K(z1.call(this,"Documents provided to .set() in an array must each have a _key property set to a string."));else J.forEach((z)=>{let F=z._key;delete z._key,this.add(z,F)}),H(B1.call(this,`Collection "${Q}" set with ${J.length} Documents.`,J))}}).catch((W)=>{K(z1.call(this,`Could not set ${Q} Collection with data ${JSON.stringify(J)}.`))})},this.setDocument=()=>{if(this.setDocumentByCriteria=()=>{let W=[];this.lf[Q].iterate((z,F)=>{if(y1(z,Z))W.push({key:F,newDocument:J})}).then(()=>{if(!W.length)K(z1.call(this,`No Documents found in ${Q} Collection with criteria ${JSON.stringify(Z)}.`));if(W.length>1)Z1.warn.call(this,`Multiple documents (${W.length}) with ${JSON.stringify(Z)} found for setting.`)}).then(()=>{W.forEach((z,F)=>{this.lf[Q].setItem(z.key,z.newDocument).then((q)=>{if(this.change(Q,t.SET,z.newDocument,z.key),F===W.length-1)H(B1.call(this,`${W.length} Document${W.length>1?"s":""} in "${Q}" collection with ${JSON.stringify(Z)} was set.`,J))}).catch((q)=>{K(z1.call(this,`Could not set ${W.length} Documents in ${Q} Collection.`))})})})},this.setDocumentByKey=()=>{this.lf[Q].setItem(Z,J).then((W)=>{this.change(Q,t.SET,J,Z),H(B1.call(this,`Document in "${Q}" collection with key ${JSON.stringify(Z)} was set.`,J))}).catch((W)=>{K(z1.call(this,`Document in "${Q}" collection with key ${JSON.stringify(Z)} could not be set.`))})},typeof Z=="object")return this.setDocumentByCriteria();else return this.setDocumentByKey()},!J)this.userErrors.push('No new Document object provided to set() method. Use an object e.g. { id: 1, name: "Bill", age: 47 }');else if(G==="doc"){if(!(typeof J=="object"&&J instanceof Array==!1))this.userErrors.push("Data passed to .set() must be an object. Not an array, string, number or boolean.")}else if(G==="collection"){if(!(typeof J=="object"&&J instanceof Array==!0))this.userErrors.push("Data passed to .set() must be an array of objects. Not an object, string, number or boolean.")}if(!this.userErrors.length){if(G=="collection")return this.setCollection();else if(G=="doc")return this.setDocument()}else $1.call(this)})}function _J(){return new Promise((J,X)=>{if(this.deleteDatabase=()=>{let Q=this.dbName;indexedDB.deleteDatabase(Q),this.change(null,t.DROP,null,null),J(B1.call(this,`Database "${Q}" deleted.`,{database:Q}))},this.deleteCollection=()=>{let Q=this.dbName,Z=this.collectionName;this.addToDeleteCollectionQueue=(G)=>{this.deleteCollectionQueue.queue.push(G),this.runDeleteCollectionQueue()},this.runDeleteCollectionQueue=()=>{if(this.deleteCollectionQueue.running==!1)this.deleteCollectionQueue.running=!0,this.deleteNextCollectionFromQueue()},this.deleteNextCollectionFromQueue=()=>{if(this.deleteCollectionQueue.queue.length){let G=this.deleteCollectionQueue.queue[0];this.deleteCollectionQueue.queue.shift(),this.lf[G].dropInstance({name:Q,storeName:G}).then(()=>{this.change(G,t.DROP,null,null),this.deleteNextCollectionFromQueue(),J(B1.call(this,`Collection "${G}" deleted.`,{collection:G}))}).catch((H)=>{X(z1.call(this,`Collection "${G}" could not be deleted.`))})}else this.deleteCollectionQueue.running=!1},this.addToDeleteCollectionQueue(Z)},this.deleteDocument=()=>{let Q=this.collectionName,Z=this.docSelectionCriteria;if(this.deleteDocumentByCriteria=()=>{let G=[];this.lf[Q].iterate((H,K)=>{if(y1(H,Z))G.push(K)}).then(()=>{if(!G.length)X(z1.call(this,`No Documents found in "${Q}" Collection with criteria ${JSON.stringify(Z)}. No documents deleted.`));if(G.length>1)Z1.warn.call(this,`Multiple documents (${G.length}) with ${JSON.stringify(Z)} found.`)}).then(()=>{G.forEach((H,K)=>{this.lf[Q].removeItem(H).then(()=>{if(K===G.length-1)this.change(Q,t.DELETE,null,H),J(B1.call(this,`${G.length} Document${G.length>1?"s":""} with ${JSON.stringify(Z)} deleted.`,{keys:G}))}).catch((W)=>{X(z1.call(this,`Could not delete ${G.length} Documents in ${Q} Collection.`))})})})},this.deleteDocumentByKey=()=>{this.lf[Q].getItem(Z).then((G)=>{if(G)this.lf[Q].removeItem(Z).then(()=>{this.change(Q,t.DELETE,G,Z),J(B1.call(this,`Document with key ${JSON.stringify(Z)} deleted.`,{key:Z}))}).catch(function(H){X(z1.call(this,`No Document found in "${Q}" Collection with key ${JSON.stringify(Z)}. No document was deleted.`))});else X(z1.call(this,`No Document found in "${Q}" Collection with key ${JSON.stringify(Z)}. No document was deleted.`))})},typeof Z=="object")return this.deleteDocumentByCriteria();else return this.deleteDocumentByKey()},!this.userErrors.length){let Q=D1.call(this);if(Q=="db")return this.deleteDatabase();else if(Q=="collection")return this.deleteCollection();else if(Q=="doc")return this.deleteDocument()}else $1.call(this)})}var nX=u1(H0(),1);async function RJ(J="",X=[],Q={highlights:!0}){if(!J)return Z1.error.call(this,"query in search is empty");if(typeof Q!=="object")return Z1.error.call(this,"no valid options");if(this.buscar=async()=>{let G=this.dbName,H=this.collectionName;if(!m.times[G])m.times[G]={};if(!m.times[G][H])m.times[G][H]=0;if(l1(G,H))clearTimeout(m.times[G][H]);else{if(!m.times[G])m.times[G]={};await AJ(G,H,this.lf)}m.times[G][H]=setTimeout(()=>{delete m.cache[G][H],delete m.times[G][H]},3600000);const K={limit:20,threshold:-1e4,key:Array.isArray(X)&&X.length?null:"_prepared_",keys:Array.isArray(X)&&X.length?X:null},W=nX.go(J,C0(G,H),K);return Z1.log.call(this,"SEARCHS",W.length),E1.call(this),W.map((z)=>z.obj&&z.obj.data?z.obj.data:z.obj)},!(typeof Q=="object"&&Q instanceof Array==!1))this.userErrors.push('Data passed to .search() must be an object. Not an array, string, number or boolean. The object must contain a "highlights" property set to true or false, e.g. { highlights: true }');else if(!Q.hasOwnProperty("highlights"))this.userErrors.push('Object passed to search() method must contain a "highlights" property set to boolean true or false, e.g. { highlights: true }');else if(typeof Q.highlights!=="boolean")this.userErrors.push('Property "highlights" passed into search() method must be assigned a boolean value (true or false). Not a string or integer.');let Z=D1.call(this);if(Z=="collection")return this.buscar();else if(Z=="doc")this.userErrors.push("Function no avalible in doc");if(this.userErrors.length)return $1.call(this),null}function UJ(J){if(!J)this.userErrors.push('No where criteria specified in where() method. object (with criteria) e.g. { id_eq: 1 }, { id_lt: 5 }, { id_gt: 5 }, { id_lte: 5 }, { id_gte: 5 }, { id_contains: "foo" }, { id_startsWith: "foo" }, { id_endsWith: "foo" }, { id_in: [1, 2, 3] }, { id_nin: [1, 2, 3] }, { id_neq: 1 }, { id_null: true }, { id_notNull: true }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_like: "foo" }, { id_notLike: "foo" }, { id_iLike: "foo" }, { id_notILike: "foo" }, { id_regexp: "foo" }, { id_notRegexp: "foo" }, { id_iRegexp: "foo" }, { id_notIRegexp: "foo" }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }, { id_between: [1, 10] }, { id_notBetween: [1, 10] }');else if(typeof J!=="object")this.userErrors.push("Where criteria specified in where() method must not be a number, boolean or string. Use object (with criteria) e.g. { id: 1 }");else if(Array.isArray(J))this.userErrors.push("Where criteria specified in where() method must not be an array. Use object (with criteria) e.g. { id: 1 }");else if(this.whereArguments.length>10)this.userErrors.push("You can only have 10 where clauses");else this.whereArguments.push(J),this.whereCount=this.whereArguments.length;return this}function y0(J,X={},Q=!1){if(J instanceof Array)return{jsonMinificado:J.map((H)=>y0(H,X,!0)),claveMinificada:X};let Z=JSON.stringify(J);Z=Z.replace(/"([^"]+)":/g,function(H,K){if(!X[K]){let W=Object.keys(X).length;const z=MQ(W++);return X[K]=z,'"'+z+'":'}else return'"'+X[K]+'":'});const G=JSON.parse(Z);return Q?G:{jsonMinificado:G,claveMinificada:X}}function MQ(J){var X="abcdefghijklmnopqrstuvwxyz",Q=X.length,Z="";while(J>=0)Z=X[J%Q]+Z,J=Math.floor(J/Q)-1;return Z}async function _Q(){return await new Promise(async(J,X)=>{try{const Q=await indexedDB.databases(),Z={};for(let G=0;G<Q.length;G++){const K=Q[G].name;Z[K]=await TJ(K)}J(Z)}catch(Q){X(Q)}})}async function iX(J,X){if(!J||!X)throw new Error("Faltan argumentos requeridos");const Q=window.indexedDB.open(J);return await new Promise((Z,G)=>{Q.onsuccess=function(H){const F=H.target.result.transaction(X,"readonly").objectStore(X).openCursor(),q=[];F.onsuccess=function(M){const O=M.target.result;if(O)q.push({key:O.key,value:O.value}),O.continue();else Z(q)},F.onerror=function(M){G(M.target.error)}},Q.onerror=function(H){G(H.target.error)}})}async function TJ(J){return await new Promise((X,Q)=>{const Z=indexedDB.open(J);Z.onsuccess=async function(G){const K=G.target.result.objectStoreNames,W={};for(let z=0;z<K.length;z++)W[K[z]]=await iX(J,K[z]);X(W)},Z.onerror=function(G){console.error("Error al abrir la base de datos:",G.target.error),Q(G.target.error)}})}async function xJ(J={}){if(!indexedDB)throw new Error("Tu navegador no soporta indexedDB");if(J&&typeof J!=="object")throw new Error("Opciones debe ser un objeto");const X=J.minify||!1;if("db"in J)if("collection"in J){const Q=await iX(J.db,J.collection);if(X){const Z={},{jsonMinificado:G}=y0(Q,Z);return{claveMinificada:Z,jsonMinificado:G}}return Q}else{if(X){const Q={},{jsonMinificado:Z}=y0(await TJ(J.db),Q);return{claveMinificada:Q,jsonMinificado:Z}}return await TJ(J.db)}return await _Q()}var j0,RQ=new Uint8Array(16);function LJ(){if(!j0){if(j0=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!j0)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}return j0(RQ)}function sX(J,X=0){return A1[J[X+0]]+A1[J[X+1]]+A1[J[X+2]]+A1[J[X+3]]+"-"+A1[J[X+4]]+A1[J[X+5]]+"-"+A1[J[X+6]]+A1[J[X+7]]+"-"+A1[J[X+8]]+A1[J[X+9]]+"-"+A1[J[X+10]]+A1[J[X+11]]+A1[J[X+12]]+A1[J[X+13]]+A1[J[X+14]]+A1[J[X+15]]}var A1=[];for(let J=0;J<256;++J)A1.push((J+256).toString(16).slice(1));var UQ=function(J,X,Q){let Z=X&&Q||0;const G=X||new Array(16);J=J||{};let H=J.node||tX,K=J.clockseq!==void 0?J.clockseq:NJ;if(H==null||K==null){const O=J.random||(J.rng||LJ)();if(H==null)H=tX=[O[0]|1,O[1],O[2],O[3],O[4],O[5]];if(K==null)K=NJ=(O[6]<<8|O[7])&16383}let W=J.msecs!==void 0?J.msecs:Date.now(),z=J.nsecs!==void 0?J.nsecs:DJ+1;const F=W-PJ+(z-DJ)/1e4;if(F<0&&J.clockseq===void 0)K=K+1&16383;if((F<0||W>PJ)&&J.nsecs===void 0)z=0;if(z>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");PJ=W,DJ=z,NJ=K,W+=12219292800000;const q=((W&268435455)*1e4+z)%4294967296;G[Z++]=q>>>24&255,G[Z++]=q>>>16&255,G[Z++]=q>>>8&255,G[Z++]=q&255;const M=W/4294967296*1e4&268435455;G[Z++]=M>>>8&255,G[Z++]=M&255,G[Z++]=M>>>24&15|16,G[Z++]=M>>>16&255,G[Z++]=K>>>8|128,G[Z++]=K&255;for(let O=0;O<6;++O)G[Z+O]=H[O];return X||sX(G)},tX,NJ,PJ=0,DJ=0,CJ=UQ;function S0(){const J=CJ();return J.substring(14,18)+J.substring(9,13)+J.substring(0,8)+J.substring(19,23)+J.substring(24,J.length)}function hJ(J){if(this.onCollection=()=>{let X=this.collectionName,Q=this.dbName;m.events.on(`db:${Q}:col:${X}`,J)},this.onDocument=()=>{let X=this.docSelectionCriteria;if(typeof X!=="string")throw new Error("no se especifico el documento a observar");m.events.on(`doc:${X}`,J)},typeof J!="function")this.userErrors.push("Callback passed to on() method must be a function");if(!this.userErrors.length){let X=D1.call(this);if(X=="collection")return this.onCollection();else if(X=="doc")return this.onDocument()}else return $1.call(this),null}function IJ(J){if(this.onCollection=()=>{let X=this.collectionName,Q=this.dbName;m.events.off(`db:${Q}:col:${X}`,J)},this.onDocument=()=>{let X=this.docSelectionCriteria;if(typeof X!=="string")throw new Error("no se especifico el documento a observar");m.events.off(`doc:${X}`,J)},typeof J!="function")this.userErrors.push("Callback passed to off() method must be a function");if(!this.userErrors.length){let X=D1.call(this);if(X=="collection")return this.onCollection();else if(X=="doc")return this.onDocument()}else return $1.call(this),null}function yJ(J){return{all:J=J||new Map,on:function(X,Q){var Z=J.get(X);Z?Z.push(Q):J.set(X,[Q])},off:function(X,Q){var Z=J.get(X);Z&&(Q?Z.splice(Z.indexOf(Q)>>>0,1):J.set(X,[]))},emit:function(X,Q){var Z=J.get(X);Z&&Z.slice().map(function(G){G(Q)}),(Z=J.get("*"))&&Z.slice().map(function(G){G(X,Q)})}}}function jJ(J,X,Q,Z,G){if(!l1(J,X))return;const H=m.cache[J][X].findIndex((K)=>K._id===Q);if(H!==-1)if(G===t.DELETE)m.cache[J][X].splice(H,1);else if(G===t.UPDATE)m.cache[J][X][H]=Z.newDocument;else m.cache[J][X][H]=Z;else if(G!==t.DELETE)if(G===t.UPDATE)m.cache[J][X].push(Z.newDocument);else m.cache[J][X].push(Z)}async function aX(J){if(!J.db)throw new Error("db no definido");if(!J.collection)throw new Error("collection no definido");if(!J.action)throw new Error("action no definido");const{db:X,collection:Q,key:Z,action:G,data:H}=J,K=new m(X);if(K.noChange=!0,K.config.debug=!1,G===t.ADD){if(!Z)throw new Error("key no definido");await K.collection(Q).add(H,Z)}else if(G===t.DELETE)if(!Z)await K.collection(Q).delete();else await K.collection(Q).doc(Z).delete();else if(G===t.UPDATE)try{if(!H.newDocument)throw new Error("newDocument no definido");await K.collection(Q).doc(Z).update(H.newDocument)}catch(W){await K.collection(Q).add(H.newDocument,Z)}else if(G===t.SET)await K.collection(Q).doc(Z).set(H);else if(G===t.DROP){if(Q)await K.collection(Q).delete();else if(X)await K.delete()}}async function oX(J){if(!J.db)throw new Error("db no definido");if(!J.collection)throw new Error("collection no definido");if(!J.action)throw new Error("action no definido");const{db:X,collection:Q,key:Z,action:G,data:H}=J,K=new m(X);if(K.noChange=!0,K.config.debug=!1,G===t.GET){if(!Z)return await K.collection(Q).doc(H).get();return await K.collection(Q).doc(Z).get()}else if(G===t.GET_ALL)return await K.collection(Q).get();else if(G===t.GET_WHERE)return await K.collection(Q).where(H).get();else if(G===t.SEARCH)return await K.collection(Q).search(H);else if(G===t.COUNT){if(H&&typeof H==="object")return await K.collection(Q).where(H).count();return await K.collection(Q).count()}}function SJ(J=10){if(typeof J!=="number")return this.userErrors.push("Valor a buscar no es valido"),this;else return this.porPag=J,this}function kJ(J=1){if(typeof J!=="number")return this.userErrors.push("Valor a buscar no es valido"),this;else if(J<1)return this.userErrors.push("Valor a buscar no es valido"),this;else return this.current=J,this}async function fJ(){if(this.collectionName===null)this.userErrors.push("No se ha seleccionado una colecci\xF3n");if(this.userErrors.length>0)$1.call(this),E1.call(this);let J=0;try{let X=this.collectionName,Q=this.dbName,Z=this.lf;return await V0({db:Q,collectionName:X,lf:Z},(G,H)=>{const K=G.data||G;p1.call(this,K)&&J++}),J}catch(X){return J}}class m{static nodeId=null;static isCloud=!1;static iDB=Y0.default.createInstance({driver:Y0.default.INDEXEDDB,name:"localbase",storeName:"internal"});static transacciones=Y0.default.createInstance({driver:Y0.default.INDEXEDDB,name:"localbase",storeName:"transacciones"});static events=yJ();static cache={};static times={};constructor(J){if(m.isCloud&&!m.nodeId)throw new Error("nodeId no definido");this.dbName=J,this.nodeId=m.nodeId,this.lf={},this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.noChange=!1,this.porPag=Infinity,this.currentPage=0,this.whereArguments=[],this.whereCount=0,this.deleteCollectionQueue={queue:[],running:!1},this.config={debug:!0},this.userErrors=[],this.collection=YJ.bind(this),this.doc=zJ.bind(this),this.orderBy=$J.bind(this),this.limit=FJ.bind(this),this.contains=BJ.bind(this),this.where=UJ.bind(this),this.get=qJ.bind(this),this.add=EJ.bind(this),this.update=OJ.bind(this),this.set=MJ.bind(this),this.delete=_J.bind(this),this.search=RJ.bind(this),this.count=fJ.bind(this),this.on=hJ.bind(this),this.off=IJ.bind(this),this.porPage=SJ.bind(this),this.page=kJ.bind(this),this.uid=S0.bind(this)}change(J,X,Q,Z){if(Z)m.events.emit(`doc:${Z}`,{action:X,data:Q}),jJ(this.dbName,J,Z,X,Q);if(m.events.emit(`db:${this.dbName}:col:${J}`,{key:Z,action:X,data:Q}),!this.noChange)m.transacciones.setItem(m.uid(),{db:this.dbName,collection:J,key:Z,action:X,data:Q,ts:Date.now()}).finally(()=>{m.events.emit("change",{db:this.dbName,collection:J,key:Z,action:X,data:Q})})}static increment=L0;static arrayUnion=N0;static arrayRemove=P0;static toTimestamp(){return Date.now()}static update=aX;static read=oX;static uid=S0;static backup=xJ;static toDateString(J){return new Date(J).toLocaleDateString()}}class o1{#J=null;#X=null;constructor(J,X){if(o1.intance)return o1.intance;if(!X)throw new Error("Localbase no definido");if(!X.uid)throw new Error("Localbase.uid no definido");if(!X.events)throw new Error("Localbase.events no definido");if(!X.iDB)throw new Error("Localbase.iDB no definido");if(!X.transacciones)throw new Error("Localbase.transacciones no definido");if(this.config=J,!this.config)throw new Error("Configuracion no definida");if(!this.config.apiKey)throw new Error("ApiKey no definido");if(!this.config.projectId)throw new Error("projectId no definido");if(!this.config.host)throw new Error("host no definido");if(!this.config.port)this.config.port=443;if(!this.config.id)this.config.id=X.uid();if(new RegExp("^[a-zA-Z][a-zA-Z0-9-]*.[a-zA-Z]+$/").test(this.config.host))throw new Error("host no valido");this.socket=new WebSocket(`ws://${this.config.host}:${this.config.port}?id=${this.config.id}&apiKey=${this.config.apiKey}&projectId=${this.config.projectId}&ts=${Date.now()}`),this.promesaConexion=new Promise((G,H)=>{this.#J=G,this.#X=H});const Q=(G)=>{console.log("data",G),this.socket.send(JSON.stringify(G))},Z=()=>{console.log("conectado"),this.socket.isOpened=!0,X.events.on("change",Q),this.#J()};this.socket.addEventListener("open",Z),this.socket.onclose=()=>{this.socket.removeEventListener("open",Z),X.events.off("change",Q),console.log("conexi\xF3n cerrada")},this.socket.onmessage=(G)=>{if(typeof G.data!=="string")return console.error("Tipo de dato no valido");if(JSON.parse(G.data).TAG==="MANTENIMIENTO")X.transacciones.clear(),X.iDB.setItem("lastUpdate",Date.now())},this.socket.onerror=(G)=>{this.socket.removeEventListener("open",Z),this.#X(G)},o1.intance=this}async connect(){return this.promesaConexion}}var TQ=function(J){let X=0;for(let G of J)X+=G.byteLength;const Q=new Uint8Array(X);let Z=0;for(let G of J){const H=new Uint8Array(G.buffer,G.byteOffset,G.byteLength);Q.set(H,Z),Z+=G.byteLength}return Q},gJ=function(J){return new eX(J).unpack()},vJ=function(J){const X=new J9,Q=X.pack(J);if(Q instanceof Promise)return Q.then(()=>X.getBuffer());return X.getBuffer()};class rX{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(J){this.flush(),this._parts.push(J)}append(J){this._pieces.push(J)}flush(){if(this._pieces.length>0){const J=new Uint8Array(this._pieces);this._parts.push(J),this._pieces=[]}}toArrayBuffer(){const J=[];for(let X of this._parts)J.push(X);return TQ(J).buffer}}class eX{constructor(J){this.index=0,this.dataBuffer=J,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const J=this.unpack_uint8();if(J<128)return J;else if((J^224)<32)return(J^224)-32;let X;if((X=J^160)<=15)return this.unpack_raw(X);else if((X=J^176)<=15)return this.unpack_string(X);else if((X=J^144)<=15)return this.unpack_array(X);else if((X=J^128)<=15)return this.unpack_map(X);switch(J){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return X=this.unpack_uint16(),this.unpack_string(X);case 217:return X=this.unpack_uint32(),this.unpack_string(X);case 218:return X=this.unpack_uint16(),this.unpack_raw(X);case 219:return X=this.unpack_uint32(),this.unpack_raw(X);case 220:return X=this.unpack_uint16(),this.unpack_array(X);case 221:return X=this.unpack_uint32(),this.unpack_array(X);case 222:return X=this.unpack_uint16(),this.unpack_map(X);case 223:return X=this.unpack_uint32(),this.unpack_map(X)}}unpack_uint8(){const J=this.dataView[this.index]&255;return this.index++,J}unpack_uint16(){const J=this.read(2),X=(J[0]&255)*256+(J[1]&255);return this.index+=2,X}unpack_uint32(){const J=this.read(4),X=((J[0]*256+J[1])*256+J[2])*256+J[3];return this.index+=4,X}unpack_uint64(){const J=this.read(8),X=((((((J[0]*256+J[1])*256+J[2])*256+J[3])*256+J[4])*256+J[5])*256+J[6])*256+J[7];return this.index+=8,X}unpack_int8(){const J=this.unpack_uint8();return J<128?J:J-256}unpack_int16(){const J=this.unpack_uint16();return J<32768?J:J-65536}unpack_int32(){const J=this.unpack_uint32();return J<2147483648?J:J-4294967296}unpack_int64(){const J=this.unpack_uint64();return J<9223372036854776000?J:J-18446744073709550000}unpack_raw(J){if(this.length<this.index+J)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${J} ${this.length}`);const X=this.dataBuffer.slice(this.index,this.index+J);return this.index+=J,X}unpack_string(J){const X=this.read(J);let Q=0,Z="",G,H;while(Q<J){if(G=X[Q],G<160)H=G,Q++;else if((G^192)<32)H=(G&31)<<6|X[Q+1]&63,Q+=2;else if((G^224)<16)H=(G&15)<<12|(X[Q+1]&63)<<6|X[Q+2]&63,Q+=3;else H=(G&7)<<18|(X[Q+1]&63)<<12|(X[Q+2]&63)<<6|X[Q+3]&63,Q+=4;Z+=String.fromCodePoint(H)}return this.index+=J,Z}unpack_array(J){const X=new Array(J);for(let Q=0;Q<J;Q++)X[Q]=this.unpack();return X}unpack_map(J){const X={};for(let Q=0;Q<J;Q++){const Z=this.unpack();X[Z]=this.unpack()}return X}unpack_float(){const J=this.unpack_uint32(),X=J>>31,Q=(J>>23&255)-127,Z=J&8388607|8388608;return(X===0?1:-1)*Z*2**(Q-23)}unpack_double(){const J=this.unpack_uint32(),X=this.unpack_uint32(),Q=J>>31,Z=(J>>20&2047)-1023,H=(J&1048575|1048576)*2**(Z-20)+X*2**(Z-52);return(Q===0?1:-1)*H}read(J){const X=this.index;if(X+J<=this.length)return this.dataView.subarray(X,X+J);else throw new Error("BinaryPackFailure: read index out of range")}}class J9{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(J){if(typeof J==="string")this.pack_string(J);else if(typeof J==="number")if(Math.floor(J)===J)this.pack_integer(J);else this.pack_double(J);else if(typeof J==="boolean"){if(J===!0)this._bufferBuilder.append(195);else if(J===!1)this._bufferBuilder.append(194)}else if(J===void 0)this._bufferBuilder.append(192);else if(typeof J==="object")if(J===null)this._bufferBuilder.append(192);else{const X=J.constructor;if(J instanceof Array){const Q=this.pack_array(J);if(Q instanceof Promise)return Q.then(()=>this._bufferBuilder.flush())}else if(J instanceof ArrayBuffer)this.pack_bin(new Uint8Array(J));else if("BYTES_PER_ELEMENT"in J){const Q=J;this.pack_bin(new Uint8Array(Q.buffer,Q.byteOffset,Q.byteLength))}else if(J instanceof Date)this.pack_string(J.toString());else if(J instanceof Blob)return J.arrayBuffer().then((Q)=>{this.pack_bin(new Uint8Array(Q)),this._bufferBuilder.flush()});else if(X==Object||X.toString().startsWith("class")){const Q=this.pack_object(J);if(Q instanceof Promise)return Q.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${X.toString()}" not yet supported`)}else throw new Error(`Type "${typeof J}" not yet supported`);this._bufferBuilder.flush()}pack_bin(J){const X=J.length;if(X<=15)this.pack_uint8(160+X);else if(X<=65535)this._bufferBuilder.append(218),this.pack_uint16(X);else if(X<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(X);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(J)}pack_string(J){const X=this._textEncoder.encode(J),Q=X.length;if(Q<=15)this.pack_uint8(176+Q);else if(Q<=65535)this._bufferBuilder.append(216),this.pack_uint16(Q);else if(Q<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(Q);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(X)}pack_array(J){const X=J.length;if(X<=15)this.pack_uint8(144+X);else if(X<=65535)this._bufferBuilder.append(220),this.pack_uint16(X);else if(X<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(X);else throw new Error("Invalid length");const Q=(Z)=>{if(Z<X){const G=this.pack(J[Z]);if(G instanceof Promise)return G.then(()=>Q(Z+1));return Q(Z+1)}};return Q(0)}pack_integer(J){if(J>=-32&&J<=127)this._bufferBuilder.append(J&255);else if(J>=0&&J<=255)this._bufferBuilder.append(204),this.pack_uint8(J);else if(J>=-128&&J<=127)this._bufferBuilder.append(208),this.pack_int8(J);else if(J>=0&&J<=65535)this._bufferBuilder.append(205),this.pack_uint16(J);else if(J>=-32768&&J<=32767)this._bufferBuilder.append(209),this.pack_int16(J);else if(J>=0&&J<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(J);else if(J>=-2147483648&&J<=2147483647)this._bufferBuilder.append(210),this.pack_int32(J);else if(J>=-9223372036854776000&&J<=9223372036854776000)this._bufferBuilder.append(211),this.pack_int64(J);else if(J>=0&&J<=18446744073709550000)this._bufferBuilder.append(207),this.pack_uint64(J);else throw new Error("Invalid integer")}pack_double(J){let X=0;if(J<0)X=1,J=-J;const Q=Math.floor(Math.log(J)/Math.LN2),Z=J/2**Q-1,G=Math.floor(Z*4503599627370496),H=4294967296,K=X<<31|Q+1023<<20|G/H&1048575,W=G%H;this._bufferBuilder.append(203),this.pack_int32(K),this.pack_int32(W)}pack_object(J){const X=Object.keys(J),Q=X.length;if(Q<=15)this.pack_uint8(128+Q);else if(Q<=65535)this._bufferBuilder.append(222),this.pack_uint16(Q);else if(Q<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(Q);else throw new Error("Invalid length");const Z=(G)=>{if(G<X.length){const H=X[G];if(J.hasOwnProperty(H)){this.pack(H);const K=this.pack(J[H]);if(K instanceof Promise)return K.then(()=>Z(G+1))}return Z(G+1)}};return Z(0)}pack_uint8(J){this._bufferBuilder.append(J)}pack_uint16(J){this._bufferBuilder.append(J>>8),this._bufferBuilder.append(J&255)}pack_uint32(J){const X=J&4294967295;this._bufferBuilder.append((X&4278190080)>>>24),this._bufferBuilder.append((X&16711680)>>>16),this._bufferBuilder.append((X&65280)>>>8),this._bufferBuilder.append(X&255)}pack_uint64(J){const X=J/4294967296,Q=J%4294967296;this._bufferBuilder.append((X&4278190080)>>>24),this._bufferBuilder.append((X&16711680)>>>16),this._bufferBuilder.append((X&65280)>>>8),this._bufferBuilder.append(X&255),this._bufferBuilder.append((Q&4278190080)>>>24),this._bufferBuilder.append((Q&16711680)>>>16),this._bufferBuilder.append((Q&65280)>>>8),this._bufferBuilder.append(Q&255)}pack_int8(J){this._bufferBuilder.append(J&255)}pack_int16(J){this._bufferBuilder.append((J&65280)>>8),this._bufferBuilder.append(J&255)}pack_int32(J){this._bufferBuilder.append(J>>>24&255),this._bufferBuilder.append((J&16711680)>>>16),this._bufferBuilder.append((J&65280)>>>8),this._bufferBuilder.append(J&255)}pack_int64(J){const X=Math.floor(J/4294967296),Q=J%4294967296;this._bufferBuilder.append((X&4278190080)>>>24),this._bufferBuilder.append((X&16711680)>>>16),this._bufferBuilder.append((X&65280)>>>8),this._bufferBuilder.append(X&255),this._bufferBuilder.append((Q&4278190080)>>>24),this._bufferBuilder.append((Q&16711680)>>>16),this._bufferBuilder.append((Q&65280)>>>8),this._bufferBuilder.append(Q&255)}constructor(){this._bufferBuilder=new rX,this._textEncoder=new TextEncoder}}function z0(J,X,Q){const Z=J.match(X);return Z&&Z.length>=Q&&parseInt(Z[Q],10)}function j1(J,X,Q){if(!J.RTCPeerConnection)return;const Z=J.RTCPeerConnection.prototype,G=Z.addEventListener;Z.addEventListener=function(K,W){if(K!==X)return G.apply(this,arguments);const z=(F)=>{const q=Q(F);if(q)if(W.handleEvent)W.handleEvent(q);else W(q)};if(this._eventMap=this._eventMap||{},!this._eventMap[X])this._eventMap[X]=new Map;return this._eventMap[X].set(W,z),G.apply(this,[K,z])};const H=Z.removeEventListener;Z.removeEventListener=function(K,W){if(K!==X||!this._eventMap||!this._eventMap[X])return H.apply(this,arguments);if(!this._eventMap[X].has(W))return H.apply(this,arguments);const z=this._eventMap[X].get(W);if(this._eventMap[X].delete(W),this._eventMap[X].size===0)delete this._eventMap[X];if(Object.keys(this._eventMap).length===0)delete this._eventMap;return H.apply(this,[K,z])},Object.defineProperty(Z,"on"+X,{get(){return this["_on"+X]},set(K){if(this["_on"+X])this.removeEventListener(X,this["_on"+X]),delete this["_on"+X];if(K)this.addEventListener(X,this["_on"+X]=K)},enumerable:!0,configurable:!0})}function G9(J){if(typeof J!=="boolean")return new Error("Argument type: "+typeof J+". Please use a boolean.");return Q9=J,J?"adapter.js logging disabled":"adapter.js logging enabled"}function H9(J){if(typeof J!=="boolean")return new Error("Argument type: "+typeof J+". Please use a boolean.");return Z9=!J,"adapter.js deprecation warnings "+(J?"disabled":"enabled")}function k0(){if(typeof window==="object"){if(Q9)return;if(typeof console!=="undefined"&&typeof console.log==="function")console.log.apply(console,arguments)}}function r1(J,X){if(!Z9)return;console.warn(J+" is deprecated, please use "+X+" instead.")}function V9(J){const X={browser:null,version:null};if(typeof J==="undefined"||!J.navigator||!J.navigator.userAgent)return X.browser="Not a browser.",X;const{navigator:Q}=J;if(Q.userAgentData&&Q.userAgentData.brands){const Z=Q.userAgentData.brands.find((G)=>{return G.brand==="Chromium"});if(Z)return{browser:"chrome",version:parseInt(Z.version,10)}}if(Q.mozGetUserMedia)X.browser="firefox",X.version=z0(Q.userAgent,/Firefox\/(\d+)\./,1);else if(Q.webkitGetUserMedia||J.isSecureContext===!1&&J.webkitRTCPeerConnection)X.browser="chrome",X.version=z0(Q.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(J.RTCPeerConnection&&Q.userAgent.match(/AppleWebKit\/(\d+)\./))X.browser="safari",X.version=z0(Q.userAgent,/AppleWebKit\/(\d+)\./,1),X.supportsUnifiedPlan=J.RTCRtpTransceiver&&"currentDirection"in J.RTCRtpTransceiver.prototype;else return X.browser="Not a supported browser.",X;return X}var X9=function(J){return Object.prototype.toString.call(J)==="[object Object]"};function mJ(J){if(!X9(J))return J;return Object.keys(J).reduce(function(X,Q){const Z=X9(J[Q]),G=Z?mJ(J[Q]):J[Q],H=Z&&!Object.keys(G).length;if(G===void 0||H)return X;return Object.assign(X,{[Q]:G})},{})}function uJ(J,X,Q){if(!X||Q.has(X.id))return;Q.set(X.id,X),Object.keys(X).forEach((Z)=>{if(Z.endsWith("Id"))uJ(J,J.get(X[Z]),Q);else if(Z.endsWith("Ids"))X[Z].forEach((G)=>{uJ(J,J.get(G),Q)})})}function bJ(J,X,Q){const Z=Q?"outbound-rtp":"inbound-rtp",G=new Map;if(X===null)return G;const H=[];return J.forEach((K)=>{if(K.type==="track"&&K.trackIdentifier===X.id)H.push(K)}),H.forEach((K)=>{J.forEach((W)=>{if(W.type===Z&&W.trackId===K.id)uJ(J,W,G)})}),G}var Q9=!0,Z9=!0;var v0={};x0(v0,{shimSenderReceiverGetStats:()=>{{return dJ}},shimPeerConnection:()=>{{return g0}},shimOnTrack:()=>{{return pJ}},shimMediaStream:()=>{{return wJ}},shimGetUserMedia:()=>{{return f0}},shimGetSendersWithDtmf:()=>{{return lJ}},shimAddTrackRemoveTrackWithNative:()=>{{return W9}},shimAddTrackRemoveTrack:()=>{{return cJ}},fixNegotiationNeeded:()=>{{return nJ}}});function f0(J,X){const Q=J&&J.navigator;if(!Q.mediaDevices)return;const Z=function(W){if(typeof W!=="object"||W.mandatory||W.optional)return W;const z={};if(Object.keys(W).forEach((F)=>{if(F==="require"||F==="advanced"||F==="mediaSource")return;const q=typeof W[F]==="object"?W[F]:{ideal:W[F]};if(q.exact!==void 0&&typeof q.exact==="number")q.min=q.max=q.exact;const M=function(O,P){if(O)return O+P.charAt(0).toUpperCase()+P.slice(1);return P==="deviceId"?"sourceId":P};if(q.ideal!==void 0){z.optional=z.optional||[];let O={};if(typeof q.ideal==="number")O[M("min",F)]=q.ideal,z.optional.push(O),O={},O[M("max",F)]=q.ideal,z.optional.push(O);else O[M("",F)]=q.ideal,z.optional.push(O)}if(q.exact!==void 0&&typeof q.exact!=="number")z.mandatory=z.mandatory||{},z.mandatory[M("",F)]=q.exact;else["min","max"].forEach((O)=>{if(q[O]!==void 0)z.mandatory=z.mandatory||{},z.mandatory[M(O,F)]=q[O]})}),W.advanced)z.optional=(z.optional||[]).concat(W.advanced);return z},G=function(W,z){if(X.version>=61)return z(W);if(W=JSON.parse(JSON.stringify(W)),W&&typeof W.audio==="object"){const F=function(q,M,O){if(M in q&&!(O in q))q[O]=q[M],delete q[M]};W=JSON.parse(JSON.stringify(W)),F(W.audio,"autoGainControl","googAutoGainControl"),F(W.audio,"noiseSuppression","googNoiseSuppression"),W.audio=Z(W.audio)}if(W&&typeof W.video==="object"){let F=W.video.facingMode;F=F&&(typeof F==="object"?F:{ideal:F});const q=X.version<66;if(F&&(F.exact==="user"||F.exact==="environment"||F.ideal==="user"||F.ideal==="environment")&&!(Q.mediaDevices.getSupportedConstraints&&Q.mediaDevices.getSupportedConstraints().facingMode&&!q)){delete W.video.facingMode;let M;if(F.exact==="environment"||F.ideal==="environment")M=["back","rear"];else if(F.exact==="user"||F.ideal==="user")M=["front"];if(M)return Q.mediaDevices.enumerateDevices().then((O)=>{O=O.filter((b)=>b.kind==="videoinput");let P=O.find((b)=>M.some((n)=>b.label.toLowerCase().includes(n)));if(!P&&O.length&&M.includes("back"))P=O[O.length-1];if(P)W.video.deviceId=F.exact?{exact:P.deviceId}:{ideal:P.deviceId};return W.video=Z(W.video),K9("chrome: "+JSON.stringify(W)),z(W)})}W.video=Z(W.video)}return K9("chrome: "+JSON.stringify(W)),z(W)},H=function(W){if(X.version>=64)return W;return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[W.name]||W.name,message:W.message,constraint:W.constraint||W.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},K=function(W,z,F){G(W,(q)=>{Q.webkitGetUserMedia(q,z,(M)=>{if(F)F(H(M))})})};if(Q.getUserMedia=K.bind(Q),Q.mediaDevices.getUserMedia){const W=Q.mediaDevices.getUserMedia.bind(Q.mediaDevices);Q.mediaDevices.getUserMedia=function(z){return G(z,(F)=>W(F).then((q)=>{if(F.audio&&!q.getAudioTracks().length||F.video&&!q.getVideoTracks().length)throw q.getTracks().forEach((M)=>{M.stop()}),new DOMException("","NotFoundError");return q},(q)=>Promise.reject(H(q))))}}}var K9=k0;function wJ(J){J.MediaStream=J.MediaStream||J.webkitMediaStream}function pJ(J){if(typeof J==="object"&&J.RTCPeerConnection&&!("ontrack"in J.RTCPeerConnection.prototype)){Object.defineProperty(J.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(Q){if(this._ontrack)this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=Q)},enumerable:!0,configurable:!0});const X=J.RTCPeerConnection.prototype.setRemoteDescription;J.RTCPeerConnection.prototype.setRemoteDescription=function Q(){if(!this._ontrackpoly)this._ontrackpoly=(Z)=>{Z.stream.addEventListener("addtrack",(G)=>{let H;if(J.RTCPeerConnection.prototype.getReceivers)H=this.getReceivers().find((W)=>W.track&&W.track.id===G.track.id);else H={track:G.track};const K=new Event("track");K.track=G.track,K.receiver=H,K.transceiver={receiver:H},K.streams=[Z.stream],this.dispatchEvent(K)}),Z.stream.getTracks().forEach((G)=>{let H;if(J.RTCPeerConnection.prototype.getReceivers)H=this.getReceivers().find((W)=>W.track&&W.track.id===G.id);else H={track:G};const K=new Event("track");K.track=G,K.receiver=H,K.transceiver={receiver:H},K.streams=[Z.stream],this.dispatchEvent(K)})},this.addEventListener("addstream",this._ontrackpoly);return X.apply(this,arguments)}}else j1(J,"track",(X)=>{if(!X.transceiver)Object.defineProperty(X,"transceiver",{value:{receiver:X.receiver}});return X})}function lJ(J){if(typeof J==="object"&&J.RTCPeerConnection&&!("getSenders"in J.RTCPeerConnection.prototype)&&"createDTMFSender"in J.RTCPeerConnection.prototype){const X=function(G,H){return{track:H,get dtmf(){if(this._dtmf===void 0)if(H.kind==="audio")this._dtmf=G.createDTMFSender(H);else this._dtmf=null;return this._dtmf},_pc:G}};if(!J.RTCPeerConnection.prototype.getSenders){J.RTCPeerConnection.prototype.getSenders=function K(){return this._senders=this._senders||[],this._senders.slice()};const G=J.RTCPeerConnection.prototype.addTrack;J.RTCPeerConnection.prototype.addTrack=function K(W,z){let F=G.apply(this,arguments);if(!F)F=X(this,W),this._senders.push(F);return F};const H=J.RTCPeerConnection.prototype.removeTrack;J.RTCPeerConnection.prototype.removeTrack=function K(W){H.apply(this,arguments);const z=this._senders.indexOf(W);if(z!==-1)this._senders.splice(z,1)}}const Q=J.RTCPeerConnection.prototype.addStream;J.RTCPeerConnection.prototype.addStream=function G(H){this._senders=this._senders||[],Q.apply(this,[H]),H.getTracks().forEach((K)=>{this._senders.push(X(this,K))})};const Z=J.RTCPeerConnection.prototype.removeStream;J.RTCPeerConnection.prototype.removeStream=function G(H){this._senders=this._senders||[],Z.apply(this,[H]),H.getTracks().forEach((K)=>{const W=this._senders.find((z)=>z.track===K);if(W)this._senders.splice(this._senders.indexOf(W),1)})}}else if(typeof J==="object"&&J.RTCPeerConnection&&"getSenders"in J.RTCPeerConnection.prototype&&"createDTMFSender"in J.RTCPeerConnection.prototype&&J.RTCRtpSender&&!("dtmf"in J.RTCRtpSender.prototype)){const X=J.RTCPeerConnection.prototype.getSenders;J.RTCPeerConnection.prototype.getSenders=function Q(){const Z=X.apply(this,[]);return Z.forEach((G)=>G._pc=this),Z},Object.defineProperty(J.RTCRtpSender.prototype,"dtmf",{get(){if(this._dtmf===void 0)if(this.track.kind==="audio")this._dtmf=this._pc.createDTMFSender(this.track);else this._dtmf=null;return this._dtmf}})}}function dJ(J){if(!(typeof J==="object"&&J.RTCPeerConnection&&J.RTCRtpSender&&J.RTCRtpReceiver))return;if(!("getStats"in J.RTCRtpSender.prototype)){const Q=J.RTCPeerConnection.prototype.getSenders;if(Q)J.RTCPeerConnection.prototype.getSenders=function G(){const H=Q.apply(this,[]);return H.forEach((K)=>K._pc=this),H};const Z=J.RTCPeerConnection.prototype.addTrack;if(Z)J.RTCPeerConnection.prototype.addTrack=function G(){const H=Z.apply(this,arguments);return H._pc=this,H};J.RTCRtpSender.prototype.getStats=function G(){const H=this;return this._pc.getStats().then((K)=>bJ(K,H.track,!0))}}if(!("getStats"in J.RTCRtpReceiver.prototype)){const Q=J.RTCPeerConnection.prototype.getReceivers;if(Q)J.RTCPeerConnection.prototype.getReceivers=function Z(){const G=Q.apply(this,[]);return G.forEach((H)=>H._pc=this),G};j1(J,"track",(Z)=>{return Z.receiver._pc=Z.srcElement,Z}),J.RTCRtpReceiver.prototype.getStats=function Z(){const G=this;return this._pc.getStats().then((H)=>bJ(H,G.track,!1))}}if(!(("getStats"in J.RTCRtpSender.prototype)&&("getStats"in J.RTCRtpReceiver.prototype)))return;const X=J.RTCPeerConnection.prototype.getStats;J.RTCPeerConnection.prototype.getStats=function Q(){if(arguments.length>0&&arguments[0]instanceof J.MediaStreamTrack){const Z=arguments[0];let G,H,K;if(this.getSenders().forEach((W)=>{if(W.track===Z)if(G)K=!0;else G=W}),this.getReceivers().forEach((W)=>{if(W.track===Z)if(H)K=!0;else H=W;return W.track===Z}),K||G&&H)return Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError"));else if(G)return G.getStats();else if(H)return H.getStats();return Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return X.apply(this,arguments)}}function W9(J){J.RTCPeerConnection.prototype.getLocalStreams=function H(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((K)=>this._shimmedLocalStreams[K][0])};const X=J.RTCPeerConnection.prototype.addTrack;J.RTCPeerConnection.prototype.addTrack=function H(K,W){if(!W)return X.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const z=X.apply(this,arguments);if(!this._shimmedLocalStreams[W.id])this._shimmedLocalStreams[W.id]=[W,z];else if(this._shimmedLocalStreams[W.id].indexOf(z)===-1)this._shimmedLocalStreams[W.id].push(z);return z};const Q=J.RTCPeerConnection.prototype.addStream;J.RTCPeerConnection.prototype.addStream=function H(K){this._shimmedLocalStreams=this._shimmedLocalStreams||{},K.getTracks().forEach((F)=>{if(this.getSenders().find((M)=>M.track===F))throw new DOMException("Track already exists.","InvalidAccessError")});const W=this.getSenders();Q.apply(this,arguments);const z=this.getSenders().filter((F)=>W.indexOf(F)===-1);this._shimmedLocalStreams[K.id]=[K].concat(z)};const Z=J.RTCPeerConnection.prototype.removeStream;J.RTCPeerConnection.prototype.removeStream=function H(K){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[K.id],Z.apply(this,arguments)};const G=J.RTCPeerConnection.prototype.removeTrack;J.RTCPeerConnection.prototype.removeTrack=function H(K){if(this._shimmedLocalStreams=this._shimmedLocalStreams||{},K)Object.keys(this._shimmedLocalStreams).forEach((W)=>{const z=this._shimmedLocalStreams[W].indexOf(K);if(z!==-1)this._shimmedLocalStreams[W].splice(z,1);if(this._shimmedLocalStreams[W].length===1)delete this._shimmedLocalStreams[W]});return G.apply(this,arguments)}}function cJ(J,X){if(!J.RTCPeerConnection)return;if(J.RTCPeerConnection.prototype.addTrack&&X.version>=65)return W9(J);const Q=J.RTCPeerConnection.prototype.getLocalStreams;J.RTCPeerConnection.prototype.getLocalStreams=function F(){const q=Q.apply(this);return this._reverseStreams=this._reverseStreams||{},q.map((M)=>this._reverseStreams[M.id])};const Z=J.RTCPeerConnection.prototype.addStream;J.RTCPeerConnection.prototype.addStream=function F(q){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},q.getTracks().forEach((M)=>{if(this.getSenders().find((P)=>P.track===M))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[q.id]){const M=new J.MediaStream(q.getTracks());this._streams[q.id]=M,this._reverseStreams[M.id]=q,q=M}Z.apply(this,[q])};const G=J.RTCPeerConnection.prototype.removeStream;J.RTCPeerConnection.prototype.removeStream=function F(q){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},G.apply(this,[this._streams[q.id]||q]),delete this._reverseStreams[this._streams[q.id]?this._streams[q.id].id:q.id],delete this._streams[q.id]},J.RTCPeerConnection.prototype.addTrack=function F(q,M){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection\'s signalingState is \'closed\'.","InvalidStateError");const O=[].slice.call(arguments,1);if(O.length!==1||!O[0].getTracks().find((n)=>n===q))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((n)=>n.track===q))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[M.id];if(b)b.addTrack(q),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const n=new J.MediaStream([q]);this._streams[M.id]=n,this._reverseStreams[n.id]=M,this.addStream(n)}return this.getSenders().find((n)=>n.track===q)};function H(F,q){let M=q.sdp;return Object.keys(F._reverseStreams||[]).forEach((O)=>{const P=F._reverseStreams[O],b=F._streams[P.id];M=M.replace(new RegExp(b.id,"g"),P.id)}),new RTCSessionDescription({type:q.type,sdp:M})}function K(F,q){let M=q.sdp;return Object.keys(F._reverseStreams||[]).forEach((O)=>{const P=F._reverseStreams[O],b=F._streams[P.id];M=M.replace(new RegExp(P.id,"g"),b.id)}),new RTCSessionDescription({type:q.type,sdp:M})}["createOffer","createAnswer"].forEach(function(F){const q=J.RTCPeerConnection.prototype[F],M={[F](){const O=arguments;if(arguments.length&&typeof arguments[0]==="function")return q.apply(this,[(b)=>{const n=H(this,b);O[0].apply(null,[n])},(b)=>{if(O[1])O[1].apply(null,b)},arguments[2]]);return q.apply(this,arguments).then((b)=>H(this,b))}};J.RTCPeerConnection.prototype[F]=M[F]});const W=J.RTCPeerConnection.prototype.setLocalDescription;J.RTCPeerConnection.prototype.setLocalDescription=function F(){if(!arguments.length||!arguments[0].type)return W.apply(this,arguments);return arguments[0]=K(this,arguments[0]),W.apply(this,arguments)};const z=Object.getOwnPropertyDescriptor(J.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(J.RTCPeerConnection.prototype,"localDescription",{get(){const F=z.get.apply(this);if(F.type==="")return F;return H(this,F)}}),J.RTCPeerConnection.prototype.removeTrack=function F(q){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection\'s signalingState is \'closed\'.","InvalidStateError");if(!q._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(q._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let O;if(Object.keys(this._streams).forEach((P)=>{if(this._streams[P].getTracks().find((n)=>q.track===n))O=this._streams[P]}),O){if(O.getTracks().length===1)this.removeStream(this._reverseStreams[O.id]);else O.removeTrack(q.track);this.dispatchEvent(new Event("negotiationneeded"))}}}function g0(J,X){if(!J.RTCPeerConnection&&J.webkitRTCPeerConnection)J.RTCPeerConnection=J.webkitRTCPeerConnection;if(!J.RTCPeerConnection)return;if(X.version<53)["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(Q){const Z=J.RTCPeerConnection.prototype[Q],G={[Q](){return arguments[0]=new(Q==="addIceCandidate"?J.RTCIceCandidate:J.RTCSessionDescription)(arguments[0]),Z.apply(this,arguments)}};J.RTCPeerConnection.prototype[Q]=G[Q]})}function nJ(J,X){j1(J,"negotiationneeded",(Q)=>{const Z=Q.target;if(X.version<72||Z.getConfiguration&&Z.getConfiguration().sdpSemantics==="plan-b"){if(Z.signalingState!=="stable")return}return Q})}var b0={};x0(b0,{shimSenderGetStats:()=>{{return sJ}},shimRemoveStream:()=>{{return aJ}},shimReceiverGetStats:()=>{{return tJ}},shimRTCDataChannel:()=>{{return oJ}},shimPeerConnection:()=>{{return m0}},shimOnTrack:()=>{{return iJ}},shimGetUserMedia:()=>{{return u0}},shimGetParameters:()=>{{return eJ}},shimGetDisplayMedia:()=>{{return Y9}},shimCreateOffer:()=>{{return JX}},shimCreateAnswer:()=>{{return XX}},shimAddTransceiver:()=>{{return rJ}}});function u0(J,X){const Q=J&&J.navigator,Z=J&&J.MediaStreamTrack;if(Q.getUserMedia=function(G,H,K){r1("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),Q.mediaDevices.getUserMedia(G).then(H,K)},!(X.version>55&&("autoGainControl"in Q.mediaDevices.getSupportedConstraints()))){const G=function(K,W,z){if(W in K&&!(z in K))K[z]=K[W],delete K[W]},H=Q.mediaDevices.getUserMedia.bind(Q.mediaDevices);if(Q.mediaDevices.getUserMedia=function(K){if(typeof K==="object"&&typeof K.audio==="object")K=JSON.parse(JSON.stringify(K)),G(K.audio,"autoGainControl","mozAutoGainControl"),G(K.audio,"noiseSuppression","mozNoiseSuppression");return H(K)},Z&&Z.prototype.getSettings){const K=Z.prototype.getSettings;Z.prototype.getSettings=function(){const W=K.apply(this,arguments);return G(W,"mozAutoGainControl","autoGainControl"),G(W,"mozNoiseSuppression","noiseSuppression"),W}}if(Z&&Z.prototype.applyConstraints){const K=Z.prototype.applyConstraints;Z.prototype.applyConstraints=function(W){if(this.kind==="audio"&&typeof W==="object")W=JSON.parse(JSON.stringify(W)),G(W,"autoGainControl","mozAutoGainControl"),G(W,"noiseSuppression","mozNoiseSuppression");return K.apply(this,[W])}}}}function Y9(J,X){if(J.navigator.mediaDevices&&"getDisplayMedia"in J.navigator.mediaDevices)return;if(!J.navigator.mediaDevices)return;J.navigator.mediaDevices.getDisplayMedia=function Q(Z){if(!(Z&&Z.video)){const G=new DOMException("getDisplayMedia without video constraints is undefined");return G.name="NotFoundError",G.code=8,Promise.reject(G)}if(Z.video===!0)Z.video={mediaSource:X};else Z.video.mediaSource=X;return J.navigator.mediaDevices.getUserMedia(Z)}}function iJ(J){if(typeof J==="object"&&J.RTCTrackEvent&&"receiver"in J.RTCTrackEvent.prototype&&!("transceiver"in J.RTCTrackEvent.prototype))Object.defineProperty(J.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function m0(J,X){if(typeof J!=="object"||!(J.RTCPeerConnection||J.mozRTCPeerConnection))return;if(!J.RTCPeerConnection&&J.mozRTCPeerConnection)J.RTCPeerConnection=J.mozRTCPeerConnection;if(X.version<53)["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(G){const H=J.RTCPeerConnection.prototype[G],K={[G](){return arguments[0]=new(G==="addIceCandidate"?J.RTCIceCandidate:J.RTCSessionDescription)(arguments[0]),H.apply(this,arguments)}};J.RTCPeerConnection.prototype[G]=K[G]});const Q={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},Z=J.RTCPeerConnection.prototype.getStats;J.RTCPeerConnection.prototype.getStats=function G(){const[H,K,W]=arguments;return Z.apply(this,[H||null]).then((z)=>{if(X.version<53&&!K)try{z.forEach((F)=>{F.type=Q[F.type]||F.type})}catch(F){if(F.name!=="TypeError")throw F;z.forEach((q,M)=>{z.set(M,Object.assign({},q,{type:Q[q.type]||q.type}))})}return z}).then(K,W)}}function sJ(J){if(!(typeof J==="object"&&J.RTCPeerConnection&&J.RTCRtpSender))return;if(J.RTCRtpSender&&"getStats"in J.RTCRtpSender.prototype)return;const X=J.RTCPeerConnection.prototype.getSenders;if(X)J.RTCPeerConnection.prototype.getSenders=function Z(){const G=X.apply(this,[]);return G.forEach((H)=>H._pc=this),G};const Q=J.RTCPeerConnection.prototype.addTrack;if(Q)J.RTCPeerConnection.prototype.addTrack=function Z(){const G=Q.apply(this,arguments);return G._pc=this,G};J.RTCRtpSender.prototype.getStats=function Z(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function tJ(J){if(!(typeof J==="object"&&J.RTCPeerConnection&&J.RTCRtpSender))return;if(J.RTCRtpSender&&"getStats"in J.RTCRtpReceiver.prototype)return;const X=J.RTCPeerConnection.prototype.getReceivers;if(X)J.RTCPeerConnection.prototype.getReceivers=function Q(){const Z=X.apply(this,[]);return Z.forEach((G)=>G._pc=this),Z};j1(J,"track",(Q)=>{return Q.receiver._pc=Q.srcElement,Q}),J.RTCRtpReceiver.prototype.getStats=function Q(){return this._pc.getStats(this.track)}}function aJ(J){if(!J.RTCPeerConnection||"removeStream"in J.RTCPeerConnection.prototype)return;J.RTCPeerConnection.prototype.removeStream=function X(Q){r1("removeStream","removeTrack"),this.getSenders().forEach((Z)=>{if(Z.track&&Q.getTracks().includes(Z.track))this.removeTrack(Z)})}}function oJ(J){if(J.DataChannel&&!J.RTCDataChannel)J.RTCDataChannel=J.DataChannel}function rJ(J){if(!(typeof J==="object"&&J.RTCPeerConnection))return;const X=J.RTCPeerConnection.prototype.addTransceiver;if(X)J.RTCPeerConnection.prototype.addTransceiver=function Q(){this.setParametersPromises=[];let Z=arguments[1]&&arguments[1].sendEncodings;if(Z===void 0)Z=[];Z=[...Z];const G=Z.length>0;if(G)Z.forEach((K)=>{if("rid"in K){if(!/^[a-z0-9]{0,16}$/i.test(K.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in K){if(!(parseFloat(K.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0")}if("maxFramerate"in K){if(!(parseFloat(K.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}});const H=X.apply(this,arguments);if(G){const{sender:K}=H,W=K.getParameters();if(!("encodings"in W)||W.encodings.length===1&&Object.keys(W.encodings[0]).length===0)W.encodings=Z,K.sendEncodings=Z,this.setParametersPromises.push(K.setParameters(W).then(()=>{delete K.sendEncodings}).catch(()=>{delete K.sendEncodings}))}return H}}function eJ(J){if(!(typeof J==="object"&&J.RTCRtpSender))return;const X=J.RTCRtpSender.prototype.getParameters;if(X)J.RTCRtpSender.prototype.getParameters=function Q(){const Z=X.apply(this,arguments);if(!("encodings"in Z))Z.encodings=[].concat(this.sendEncodings||[{}]);return Z}}function JX(J){if(!(typeof J==="object"&&J.RTCPeerConnection))return;const X=J.RTCPeerConnection.prototype.createOffer;J.RTCPeerConnection.prototype.createOffer=function Q(){if(this.setParametersPromises&&this.setParametersPromises.length)return Promise.all(this.setParametersPromises).then(()=>{return X.apply(this,arguments)}).finally(()=>{this.setParametersPromises=[]});return X.apply(this,arguments)}}function XX(J){if(!(typeof J==="object"&&J.RTCPeerConnection))return;const X=J.RTCPeerConnection.prototype.createAnswer;J.RTCPeerConnection.prototype.createAnswer=function Q(){if(this.setParametersPromises&&this.setParametersPromises.length)return Promise.all(this.setParametersPromises).then(()=>{return X.apply(this,arguments)}).finally(()=>{this.setParametersPromises=[]});return X.apply(this,arguments)}}var w0={};x0(w0,{shimTrackEventTransceiver:()=>{{return KX}},shimRemoteStreamsAPI:()=>{{return ZX}},shimRTCIceServerUrls:()=>{{return VX}},shimLocalStreamsAPI:()=>{{return QX}},shimGetUserMedia:()=>{{return HX}},shimCreateOfferLegacy:()=>{{return WX}},shimConstraints:()=>{{return z9}},shimCallbacksAPI:()=>{{return GX}},shimAudioContext:()=>{{return YX}}});function QX(J){if(typeof J!=="object"||!J.RTCPeerConnection)return;if(!("getLocalStreams"in J.RTCPeerConnection.prototype))J.RTCPeerConnection.prototype.getLocalStreams=function X(){if(!this._localStreams)this._localStreams=[];return this._localStreams};if(!("addStream"in J.RTCPeerConnection.prototype)){const X=J.RTCPeerConnection.prototype.addTrack;J.RTCPeerConnection.prototype.addStream=function Q(Z){if(!this._localStreams)this._localStreams=[];if(!this._localStreams.includes(Z))this._localStreams.push(Z);Z.getAudioTracks().forEach((G)=>X.call(this,G,Z)),Z.getVideoTracks().forEach((G)=>X.call(this,G,Z))},J.RTCPeerConnection.prototype.addTrack=function Q(Z,...G){if(G)G.forEach((H)=>{if(!this._localStreams)this._localStreams=[H];else if(!this._localStreams.includes(H))this._localStreams.push(H)});return X.apply(this,arguments)}}if(!("removeStream"in J.RTCPeerConnection.prototype))J.RTCPeerConnection.prototype.removeStream=function X(Q){if(!this._localStreams)this._localStreams=[];const Z=this._localStreams.indexOf(Q);if(Z===-1)return;this._localStreams.splice(Z,1);const G=Q.getTracks();this.getSenders().forEach((H)=>{if(G.includes(H.track))this.removeTrack(H)})}}function ZX(J){if(typeof J!=="object"||!J.RTCPeerConnection)return;if(!("getRemoteStreams"in J.RTCPeerConnection.prototype))J.RTCPeerConnection.prototype.getRemoteStreams=function X(){return this._remoteStreams?this._remoteStreams:[]};if(!("onaddstream"in J.RTCPeerConnection.prototype)){Object.defineProperty(J.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(Q){if(this._onaddstream)this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly);this.addEventListener("addstream",this._onaddstream=Q),this.addEventListener("track",this._onaddstreampoly=(Z)=>{Z.streams.forEach((G)=>{if(!this._remoteStreams)this._remoteStreams=[];if(this._remoteStreams.includes(G))return;this._remoteStreams.push(G);const H=new Event("addstream");H.stream=G,this.dispatchEvent(H)})})}});const X=J.RTCPeerConnection.prototype.setRemoteDescription;J.RTCPeerConnection.prototype.setRemoteDescription=function Q(){const Z=this;if(!this._onaddstreampoly)this.addEventListener("track",this._onaddstreampoly=function(G){G.streams.forEach((H)=>{if(!Z._remoteStreams)Z._remoteStreams=[];if(Z._remoteStreams.indexOf(H)>=0)return;Z._remoteStreams.push(H);const K=new Event("addstream");K.stream=H,Z.dispatchEvent(K)})});return X.apply(Z,arguments)}}}function GX(J){if(typeof J!=="object"||!J.RTCPeerConnection)return;const X=J.RTCPeerConnection.prototype,Q=X.createOffer,Z=X.createAnswer,G=X.setLocalDescription,H=X.setRemoteDescription,K=X.addIceCandidate;X.createOffer=function z(F,q){const M=arguments.length>=2?arguments[2]:arguments[0],O=Q.apply(this,[M]);if(!q)return O;return O.then(F,q),Promise.resolve()},X.createAnswer=function z(F,q){const M=arguments.length>=2?arguments[2]:arguments[0],O=Z.apply(this,[M]);if(!q)return O;return O.then(F,q),Promise.resolve()};let W=function(z,F,q){const M=G.apply(this,[z]);if(!q)return M;return M.then(F,q),Promise.resolve()};X.setLocalDescription=W,W=function(z,F,q){const M=H.apply(this,[z]);if(!q)return M;return M.then(F,q),Promise.resolve()},X.setRemoteDescription=W,W=function(z,F,q){const M=K.apply(this,[z]);if(!q)return M;return M.then(F,q),Promise.resolve()},X.addIceCandidate=W}function HX(J){const X=J&&J.navigator;if(X.mediaDevices&&X.mediaDevices.getUserMedia){const Q=X.mediaDevices,Z=Q.getUserMedia.bind(Q);X.mediaDevices.getUserMedia=(G)=>{return Z(z9(G))}}if(!X.getUserMedia&&X.mediaDevices&&X.mediaDevices.getUserMedia)X.getUserMedia=function Q(Z,G,H){X.mediaDevices.getUserMedia(Z).then(G,H)}.bind(X)}function z9(J){if(J&&J.video!==void 0)return Object.assign({},J,{video:mJ(J.video)});return J}function VX(J){if(!J.RTCPeerConnection)return;const X=J.RTCPeerConnection;if(J.RTCPeerConnection=function Q(Z,G){if(Z&&Z.iceServers){const H=[];for(let K=0;K<Z.iceServers.length;K++){let W=Z.iceServers[K];if(W.urls===void 0&&W.url)r1("RTCIceServer.url","RTCIceServer.urls"),W=JSON.parse(JSON.stringify(W)),W.urls=W.url,delete W.url,H.push(W);else H.push(Z.iceServers[K])}Z.iceServers=H}return new X(Z,G)},J.RTCPeerConnection.prototype=X.prototype,"generateCertificate"in X)Object.defineProperty(J.RTCPeerConnection,"generateCertificate",{get(){return X.generateCertificate}})}function KX(J){if(typeof J==="object"&&J.RTCTrackEvent&&"receiver"in J.RTCTrackEvent.prototype&&!("transceiver"in J.RTCTrackEvent.prototype))Object.defineProperty(J.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function WX(J){const X=J.RTCPeerConnection.prototype.createOffer;J.RTCPeerConnection.prototype.createOffer=function Q(Z){if(Z){if(typeof Z.offerToReceiveAudio!=="undefined")Z.offerToReceiveAudio=!!Z.offerToReceiveAudio;const G=this.getTransceivers().find((K)=>K.receiver.track.kind==="audio");if(Z.offerToReceiveAudio===!1&&G){if(G.direction==="sendrecv")if(G.setDirection)G.setDirection("sendonly");else G.direction="sendonly";else if(G.direction==="recvonly")if(G.setDirection)G.setDirection("inactive");else G.direction="inactive"}else if(Z.offerToReceiveAudio===!0&&!G)this.addTransceiver("audio",{direction:"recvonly"});if(typeof Z.offerToReceiveVideo!=="undefined")Z.offerToReceiveVideo=!!Z.offerToReceiveVideo;const H=this.getTransceivers().find((K)=>K.receiver.track.kind==="video");if(Z.offerToReceiveVideo===!1&&H){if(H.direction==="sendrecv")if(H.setDirection)H.setDirection("sendonly");else H.direction="sendonly";else if(H.direction==="recvonly")if(H.setDirection)H.setDirection("inactive");else H.direction="inactive"}else if(Z.offerToReceiveVideo===!0&&!H)this.addTransceiver("video",{direction:"recvonly"})}return X.apply(this,arguments)}}function YX(J){if(typeof J!=="object"||J.AudioContext)return;J.AudioContext=J.webkitAudioContext}var FX={};x0(FX,{shimSendThrowTypeError:()=>{{return B0}},shimRTCIceCandidateRelayProtocol:()=>{{return p0}},shimRTCIceCandidate:()=>{{return $0}},shimParameterlessSetLocalDescription:()=>{{return q0}},shimMaxMessageSize:()=>{{return F0}},shimConnectionState:()=>{{return l0}},shimAddIceCandidateNullOrEmpty:()=>{{return A0}},removeExtmapAllowMixed:()=>{{return d0}}});var e1=u1($X(),1);function $0(J){if(!J.RTCIceCandidate||J.RTCIceCandidate&&"foundation"in J.RTCIceCandidate.prototype)return;const X=J.RTCIceCandidate;J.RTCIceCandidate=function Q(Z){if(typeof Z==="object"&&Z.candidate&&Z.candidate.indexOf("a=")===0)Z=JSON.parse(JSON.stringify(Z)),Z.candidate=Z.candidate.substring(2);if(Z.candidate&&Z.candidate.length){const G=new X(Z),H=e1.default.parseCandidate(Z.candidate);for(let K in H)if(!(K in G))Object.defineProperty(G,K,{value:H[K]});return G.toJSON=function K(){return{candidate:G.candidate,sdpMid:G.sdpMid,sdpMLineIndex:G.sdpMLineIndex,usernameFragment:G.usernameFragment}},G}return new X(Z)},J.RTCIceCandidate.prototype=X.prototype,j1(J,"icecandidate",(Q)=>{if(Q.candidate)Object.defineProperty(Q,"candidate",{value:new J.RTCIceCandidate(Q.candidate),writable:"false"});return Q})}function p0(J){if(!J.RTCIceCandidate||J.RTCIceCandidate&&"relayProtocol"in J.RTCIceCandidate.prototype)return;j1(J,"icecandidate",(X)=>{if(X.candidate){const Q=e1.default.parseCandidate(X.candidate.candidate);if(Q.type==="relay")X.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[Q.priority>>24]}return X})}function F0(J,X){if(!J.RTCPeerConnection)return;if(!("sctp"in J.RTCPeerConnection.prototype))Object.defineProperty(J.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp==="undefined"?null:this._sctp}});const Q=function(W){if(!W||!W.sdp)return!1;const z=e1.default.splitSections(W.sdp);return z.shift(),z.some((F)=>{const q=e1.default.parseMLine(F);return q&&q.kind==="application"&&q.protocol.indexOf("SCTP")!==-1})},Z=function(W){const z=W.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(z===null||z.length<2)return-1;const F=parseInt(z[1],10);return F!==F?-1:F},G=function(W){let z=65536;if(X.browser==="firefox")if(X.version<57)if(W===-1)z=16384;else z=2147483637;else if(X.version<60)z=X.version===57?65535:65536;else z=2147483637;return z},H=function(W,z){let F=65536;if(X.browser==="firefox"&&X.version===57)F=65535;const q=e1.default.matchPrefix(W.sdp,"a=max-message-size:");if(q.length>0)F=parseInt(q[0].substring(19),10);else if(X.browser==="firefox"&&z!==-1)F=2147483637;return F},K=J.RTCPeerConnection.prototype.setRemoteDescription;J.RTCPeerConnection.prototype.setRemoteDescription=function W(){if(this._sctp=null,X.browser==="chrome"&&X.version>=76){const{sdpSemantics:z}=this.getConfiguration();if(z==="plan-b")Object.defineProperty(this,"sctp",{get(){return typeof this._sctp==="undefined"?null:this._sctp},enumerable:!0,configurable:!0})}if(Q(arguments[0])){const z=Z(arguments[0]),F=G(z),q=H(arguments[0],z);let M;if(F===0&&q===0)M=Number.POSITIVE_INFINITY;else if(F===0||q===0)M=Math.max(F,q);else M=Math.min(F,q);const O={};Object.defineProperty(O,"maxMessageSize",{get(){return M}}),this._sctp=O}return K.apply(this,arguments)}}function B0(J){if(!(J.RTCPeerConnection&&("createDataChannel"in J.RTCPeerConnection.prototype)))return;function X(Z,G){const H=Z.send;Z.send=function K(){const W=arguments[0],z=W.length||W.size||W.byteLength;if(Z.readyState==="open"&&G.sctp&&z>G.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+G.sctp.maxMessageSize+" bytes)");return H.apply(Z,arguments)}}const Q=J.RTCPeerConnection.prototype.createDataChannel;J.RTCPeerConnection.prototype.createDataChannel=function Z(){const G=Q.apply(this,arguments);return X(G,this),G},j1(J,"datachannel",(Z)=>{return X(Z.channel,Z.target),Z})}function l0(J){if(!J.RTCPeerConnection||"connectionState"in J.RTCPeerConnection.prototype)return;const X=J.RTCPeerConnection.prototype;Object.defineProperty(X,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(X,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(Q){if(this._onconnectionstatechange)this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange;if(Q)this.addEventListener("connectionstatechange",this._onconnectionstatechange=Q)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((Q)=>{const Z=X[Q];X[Q]=function(){if(!this._connectionstatechangepoly)this._connectionstatechangepoly=(G)=>{const H=G.target;if(H._lastConnectionState!==H.connectionState){H._lastConnectionState=H.connectionState;const K=new Event("connectionstatechange",G);H.dispatchEvent(K)}return G},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly);return Z.apply(this,arguments)}})}function d0(J,X){if(!J.RTCPeerConnection)return;if(X.browser==="chrome"&&X.version>=71)return;if(X.browser==="safari"&&X.version>=605)return;const Q=J.RTCPeerConnection.prototype.setRemoteDescription;J.RTCPeerConnection.prototype.setRemoteDescription=function Z(G){if(G&&G.sdp&&G.sdp.indexOf("\na=extmap-allow-mixed")!==-1){const H=G.sdp.split("\n").filter((K)=>{return K.trim()!=="a=extmap-allow-mixed"}).join("\n");if(J.RTCSessionDescription&&G instanceof J.RTCSessionDescription)arguments[0]=new J.RTCSessionDescription({type:G.type,sdp:H});else G.sdp=H}return Q.apply(this,arguments)}}function A0(J,X){if(!(J.RTCPeerConnection&&J.RTCPeerConnection.prototype))return;const Q=J.RTCPeerConnection.prototype.addIceCandidate;if(!Q||Q.length===0)return;J.RTCPeerConnection.prototype.addIceCandidate=function Z(){if(!arguments[0]){if(arguments[1])arguments[1].apply(null);return Promise.resolve()}if((X.browser==="chrome"&&X.version<78||X.browser==="firefox"&&X.version<68||X.browser==="safari")&&arguments[0]&&arguments[0].candidate==="")return Promise.resolve();return Q.apply(this,arguments)}}function q0(J,X){if(!(J.RTCPeerConnection&&J.RTCPeerConnection.prototype))return;const Q=J.RTCPeerConnection.prototype.setLocalDescription;if(!Q||Q.length===0)return;J.RTCPeerConnection.prototype.setLocalDescription=function Z(){let G=arguments[0]||{};if(typeof G!=="object"||G.type&&G.sdp)return Q.apply(this,arguments);if(G={type:G.type,sdp:G.sdp},!G.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":G.type="offer";break;default:G.type="answer";break}if(G.sdp||G.type!=="offer"&&G.type!=="answer")return Q.apply(this,[G]);return(G.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((K)=>Q.apply(this,[K]))}}var xQ=u1($X(),1);function $9({window:J}={},X={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const Q=k0,Z=V9(J),G={browserDetails:Z,commonShim:FX,extractVersion:z0,disableLog:G9,disableWarnings:H9,sdp:xQ};switch(Z.browser){case"chrome":if(!v0||!g0||!X.shimChrome)return Q("Chrome shim is not included in this adapter release."),G;if(Z.version===null)return Q("Chrome shim can not determine version, not shimming."),G;Q("adapter.js shimming chrome."),G.browserShim=v0,A0(J,Z),q0(J,Z),f0(J,Z),wJ(J,Z),g0(J,Z),pJ(J,Z),cJ(J,Z),lJ(J,Z),dJ(J,Z),nJ(J,Z),$0(J,Z),p0(J,Z),l0(J,Z),F0(J,Z),B0(J,Z),d0(J,Z);break;case"firefox":if(!b0||!m0||!X.shimFirefox)return Q("Firefox shim is not included in this adapter release."),G;Q("adapter.js shimming firefox."),G.browserShim=b0,A0(J,Z),q0(J,Z),u0(J,Z),m0(J,Z),iJ(J,Z),aJ(J,Z),sJ(J,Z),tJ(J,Z),oJ(J,Z),rJ(J,Z),eJ(J,Z),JX(J,Z),XX(J,Z),$0(J,Z),l0(J,Z),F0(J,Z),B0(J,Z);break;case"safari":if(!w0||!X.shimSafari)return Q("Safari shim is not included in this adapter release."),G;Q("adapter.js shimming safari."),G.browserShim=w0,A0(J,Z),q0(J,Z),VX(J,Z),WX(J,Z),GX(J,Z),QX(J,Z),ZX(J,Z),KX(J,Z),HX(J,Z),YX(J,Z),$0(J,Z),p0(J,Z),F0(J,Z),B0(J,Z),d0(J,Z);break;default:Q("Unsupported browser!");break}return G}var LQ=$9({window:typeof window==="undefined"?void 0:window}),BX=LQ;var c1=function(J,X,Q,Z){Object.defineProperty(J,X,{get:Q,set:Z,enumerable:!0,configurable:!0})},NQ=function(J){let X=0;for(let G of J)X+=G.byteLength;const Q=new Uint8Array(X);let Z=0;for(let G of J)Q.set(G,Z),Z+=G.byteLength;return Q},O0=function(){},hQ=function(J,X,Q){this.fn=J,this.context=X,this.once=Q||!1},O9=function(J,X,Q,Z,G){if(typeof Q!=="function")throw new TypeError("The listener must be a function");var H=new hQ(Q,Z||J,G),K=R1?R1+X:X;if(!J._events[K])J._events[K]=H,J._eventsCount++;else if(!J._events[K].fn)J._events[K].push(H);else J._events[K]=[J._events[K],H];return J},c0=function(J,X){if(--J._eventsCount===0)J._events=new O0;else delete J._events[X]},O1=function(){this._events=new O0,this._eventsCount=0};class qX{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=(J)=>{const X=[],Q=J.byteLength,Z=Math.ceil(Q/this.chunkedMTU);let G=0,H=0;while(H<Q){const K=Math.min(Q,H+this.chunkedMTU),W=J.slice(H,K),z={__peerData:this._dataCount,n:G,data:W,total:Z};X.push(z),H=K,G++}return this._dataCount++,X}}}var AX=BX.default||BX,E0=new class{isWebRTCSupported(){return typeof RTCPeerConnection!=="undefined"}isBrowserSupported(){const J=this.getBrowser(),X=this.getVersion();if(!this.supportedBrowsers.includes(J))return!1;if(J==="chrome")return X>=this.minChromeVersion;if(J==="firefox")return X>=this.minFirefoxVersion;if(J==="safari")return!this.isIOS&&X>=this.minSafariVersion;return!1}getBrowser(){return AX.browserDetails.browser}getVersion(){return AX.browserDetails.version||0}isUnifiedPlanSupported(){const J=this.getBrowser(),X=AX.browserDetails.version||0;if(J==="chrome"&&X<this.minChromeVersion)return!1;if(J==="firefox"&&X>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let Q,Z=!1;try{Q=new RTCPeerConnection,Q.addTransceiver("audio"),Z=!0}catch(G){}finally{if(Q)Q.close()}return Z}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator!=="undefined"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},PQ=(J)=>{return!J||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(J)},A9=()=>Math.random().toString(36).slice(2),F9={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class q9 extends qX{noop(){}blobToArrayBuffer(J,X){const Q=new FileReader;return Q.onload=function(Z){if(Z.target)X(Z.target.result)},Q.readAsArrayBuffer(J),Q}binaryStringToArrayBuffer(J){const X=new Uint8Array(J.length);for(let Q=0;Q<J.length;Q++)X[Q]=J.charCodeAt(Q)&255;return X.buffer}isSecure(){return location.protocol==="https:"}constructor(...J){super(...J);this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=F9,this.browser=E0.getBrowser(),this.browserVersion=E0.getVersion(),this.pack=vJ,this.unpack=gJ,this.supports=function(){const X={browser:E0.isBrowserSupported(),webRTC:E0.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!X.webRTC)return X;let Q;try{Q=new RTCPeerConnection(F9),X.audioVideo=!0;let Z;try{Z=Q.createDataChannel("_PEERJSTEST",{ordered:!0}),X.data=!0,X.reliable=!!Z.ordered;try{Z.binaryType="blob",X.binaryBlob=!E0.isIOS}catch(G){}}catch(G){}finally{if(Z)Z.close()}}catch(Z){}finally{if(Q)Q.close()}return X}(),this.validateId=PQ,this.randomToken=A9}}var L1=new q9,DQ="PeerJS: ",B9;(function(J){J[J.Disabled=0]="Disabled",J[J.Errors=1]="Errors",J[J.Warnings=2]="Warnings",J[J.All=3]="All"})(B9||(B9={}));class E9{get logLevel(){return this._logLevel}set logLevel(J){this._logLevel=J}log(...J){if(this._logLevel>=3)this._print(3,...J)}warn(...J){if(this._logLevel>=2)this._print(2,...J)}error(...J){if(this._logLevel>=1)this._print(1,...J)}setLogFunction(J){this._print=J}_print(J,...X){const Q=[DQ,...X];for(let Z in Q)if(Q[Z]instanceof Error)Q[Z]="("+Q[Z].name+") "+Q[Z].message;if(J>=3)console.log(...Q);else if(J>=2)console.warn("WARNING",...Q);else if(J>=1)console.error("ERROR",...Q)}constructor(){this._logLevel=0}}var S=new E9,EX={},CQ=Object.prototype.hasOwnProperty,R1="~";if(Object.create){if(O0.prototype=Object.create(null),!new O0().__proto__)R1=!1}O1.prototype.eventNames=function J(){var X=[],Q,Z;if(this._eventsCount===0)return X;for(Z in Q=this._events)if(CQ.call(Q,Z))X.push(R1?Z.slice(1):Z);if(Object.getOwnPropertySymbols)return X.concat(Object.getOwnPropertySymbols(Q));return X};O1.prototype.listeners=function J(X){var Q=R1?R1+X:X,Z=this._events[Q];if(!Z)return[];if(Z.fn)return[Z.fn];for(var G=0,H=Z.length,K=new Array(H);G<H;G++)K[G]=Z[G].fn;return K};O1.prototype.listenerCount=function J(X){var Q=R1?R1+X:X,Z=this._events[Q];if(!Z)return 0;if(Z.fn)return 1;return Z.length};O1.prototype.emit=function J(X,Q,Z,G,H,K){var W=R1?R1+X:X;if(!this._events[W])return!1;var z=this._events[W],F=arguments.length,q,M;if(z.fn){if(z.once)this.removeListener(X,z.fn,void 0,!0);switch(F){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,Q),!0;case 3:return z.fn.call(z.context,Q,Z),!0;case 4:return z.fn.call(z.context,Q,Z,G),!0;case 5:return z.fn.call(z.context,Q,Z,G,H),!0;case 6:return z.fn.call(z.context,Q,Z,G,H,K),!0}for(M=1,q=new Array(F-1);M<F;M++)q[M-1]=arguments[M];z.fn.apply(z.context,q)}else{var O=z.length,P;for(M=0;M<O;M++){if(z[M].once)this.removeListener(X,z[M].fn,void 0,!0);switch(F){case 1:z[M].fn.call(z[M].context);break;case 2:z[M].fn.call(z[M].context,Q);break;case 3:z[M].fn.call(z[M].context,Q,Z);break;case 4:z[M].fn.call(z[M].context,Q,Z,G);break;default:if(!q)for(P=1,q=new Array(F-1);P<F;P++)q[P-1]=arguments[P];z[M].fn.apply(z[M].context,q)}}}return!0};O1.prototype.on=function J(X,Q,Z){return O9(this,X,Q,Z,!1)};O1.prototype.once=function J(X,Q,Z){return O9(this,X,Q,Z,!0)};O1.prototype.removeListener=function J(X,Q,Z,G){var H=R1?R1+X:X;if(!this._events[H])return this;if(!Q)return c0(this,H),this;var K=this._events[H];if(K.fn){if(K.fn===Q&&(!G||K.once)&&(!Z||K.context===Z))c0(this,H)}else{for(var W=0,z=[],F=K.length;W<F;W++)if(K[W].fn!==Q||G&&!K[W].once||Z&&K[W].context!==Z)z.push(K[W]);if(z.length)this._events[H]=z.length===1?z[0]:z;else c0(this,H)}return this};O1.prototype.removeAllListeners=function J(X){var Q;if(X){if(Q=R1?R1+X:X,this._events[Q])c0(this,Q)}else this._events=new O0,this._eventsCount=0;return this};O1.prototype.off=O1.prototype.removeListener;O1.prototype.addListener=O1.prototype.on;O1.prefixed=R1;O1.EventEmitter=O1;EX=O1;var n1={};c1(n1,"ConnectionType",()=>k1);c1(n1,"PeerErrorType",()=>V1);c1(n1,"BaseConnectionErrorType",()=>M0);c1(n1,"DataConnectionErrorType",()=>_0);c1(n1,"SerializationType",()=>J0);c1(n1,"SocketEventType",()=>S1);c1(n1,"ServerMessageType",()=>F1);var k1;(function(J){J.Data="data",J.Media="media"})(k1||(k1={}));var V1;(function(J){J.BrowserIncompatible="browser-incompatible",J.Disconnected="disconnected",J.InvalidID="invalid-id",J.InvalidKey="invalid-key",J.Network="network",J.PeerUnavailable="peer-unavailable",J.SslUnavailable="ssl-unavailable",J.ServerError="server-error",J.SocketError="socket-error",J.SocketClosed="socket-closed",J.UnavailableID="unavailable-id",J.WebRTC="webrtc"})(V1||(V1={}));var M0;(function(J){J.NegotiationFailed="negotiation-failed",J.ConnectionClosed="connection-closed"})(M0||(M0={}));var _0;(function(J){J.NotOpenYet="not-open-yet",J.MessageToBig="message-too-big"})(_0||(_0={}));var J0;(function(J){J.Binary="binary",J.BinaryUTF8="binary-utf8",J.JSON="json",J.None="raw"})(J0||(J0={}));var S1;(function(J){J.Message="message",J.Disconnected="disconnected",J.Error="error",J.Close="close"})(S1||(S1={}));var F1;(function(J){J.Heartbeat="HEARTBEAT",J.Candidate="CANDIDATE",J.Offer="OFFER",J.Answer="ANSWER",J.Open="OPEN",J.Error="ERROR",J.IdTaken="ID-TAKEN",J.InvalidKey="INVALID-KEY",J.Leave="LEAVE",J.Expire="EXPIRE"})(F1||(F1={}));var OX={};OX=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class M9 extends EX.EventEmitter{constructor(J,X,Q,Z,G,H=5000){super();this.pingInterval=H,this._disconnected=!0,this._messagesQueue=[];const K=J?"wss://":"ws://";this._baseUrl=K+X+":"+Q+Z+"peerjs?key="+G}start(J,X){this._id=J;const Q=`${this._baseUrl}&id=${J}&token=${X}`;if(!!this._socket||!this._disconnected)return;this._socket=new WebSocket(Q+"&version="+OX.version),this._disconnected=!1,this._socket.onmessage=(Z)=>{let G;try{G=JSON.parse(Z.data),S.log("Server message received:",G)}catch(H){S.log("Invalid server message",Z.data);return}this.emit(S1.Message,G)},this._socket.onclose=(Z)=>{if(this._disconnected)return;S.log("Socket closed.",Z),this._cleanup(),this._disconnected=!0,this.emit(S1.Disconnected)},this._socket.onopen=()=>{if(this._disconnected)return;this._sendQueuedMessages(),S.log("Socket open"),this._scheduleHeartbeat()}}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){S.log("Cannot send heartbeat, because socket closed");return}const J=JSON.stringify({type:F1.Heartbeat});this._socket.send(J),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const J=[...this._messagesQueue];this._messagesQueue=[];for(let X of J)this.send(X)}send(J){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(J);return}if(!J.type){this.emit(S1.Error,"Invalid message");return}if(!this._wsOpen())return;const X=JSON.stringify(J);this._socket.send(X)}close(){if(this._disconnected)return;this._cleanup(),this._disconnected=!0}_cleanup(){if(this._socket)this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0;clearTimeout(this._wsPingTimer)}}class MX{constructor(J){this.connection=J}startConnection(J){const X=this._startPeerConnection();if(this.connection.peerConnection=X,this.connection.type===k1.Media&&J._stream)this._addTracksToConnection(J._stream,X);if(J.originator){const Q=this.connection,Z={ordered:!!J.reliable},G=X.createDataChannel(Q.label,Z);Q._initializeDataChannel(G),this._makeOffer()}else this.handleSDP("OFFER",J.sdp)}_startPeerConnection(){S.log("Creating RTCPeerConnection.");const J=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(J),J}_setupListeners(J){const X=this.connection.peer,Q=this.connection.connectionId,Z=this.connection.type,G=this.connection.provider;S.log("Listening for ICE candidates."),J.onicecandidate=(H)=>{if(!H.candidate||!H.candidate.candidate)return;S.log(`Received ICE candidates for ${X}:`,H.candidate),G.socket.send({type:F1.Candidate,payload:{candidate:H.candidate,type:Z,connectionId:Q},dst:X})},J.oniceconnectionstatechange=()=>{switch(J.iceConnectionState){case"failed":S.log("iceConnectionState is failed, closing connections to "+X),this.connection.emitError(M0.NegotiationFailed,"Negotiation of connection to "+X+" failed."),this.connection.close();break;case"closed":S.log("iceConnectionState is closed, closing connections to "+X),this.connection.emitError(M0.ConnectionClosed,"Connection to "+X+" closed."),this.connection.close();break;case"disconnected":S.log("iceConnectionState changed to disconnected on the connection with "+X);break;case"completed":J.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",J.iceConnectionState)},S.log("Listening for data channel"),J.ondatachannel=(H)=>{S.log("Received data channel");const K=H.channel;G.getConnection(X,Q)._initializeDataChannel(K)},S.log("Listening for remote stream"),J.ontrack=(H)=>{S.log("Received remote stream");const K=H.streams[0],W=G.getConnection(X,Q);if(W.type===k1.Media){const z=W;this._addStreamToMediaConnection(K,z)}}}cleanup(){S.log("Cleaning up PeerConnection to "+this.connection.peer);const J=this.connection.peerConnection;if(!J)return;this.connection.peerConnection=null,J.onicecandidate=J.oniceconnectionstatechange=J.ondatachannel=J.ontrack=()=>{};const X=J.signalingState!=="closed";let Q=!1;const Z=this.connection.dataChannel;if(Z)Q=!!Z.readyState&&Z.readyState!=="closed";if(X||Q)J.close()}async _makeOffer(){const J=this.connection.peerConnection,X=this.connection.provider;try{const Q=await J.createOffer(this.connection.options.constraints);if(S.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform==="function")Q.sdp=this.connection.options.sdpTransform(Q.sdp)||Q.sdp;try{await J.setLocalDescription(Q),S.log("Set localDescription:",Q,`for:${this.connection.peer}`);let Z={sdp:Q,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===k1.Data){const G=this.connection;Z={...Z,label:G.label,reliable:G.reliable,serialization:G.serialization}}X.socket.send({type:F1.Offer,payload:Z,dst:this.connection.peer})}catch(Z){if(Z!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer")X.emitError(V1.WebRTC,Z),S.log("Failed to setLocalDescription, ",Z)}}catch(Q){X.emitError(V1.WebRTC,Q),S.log("Failed to createOffer, ",Q)}}async _makeAnswer(){const J=this.connection.peerConnection,X=this.connection.provider;try{const Q=await J.createAnswer();if(S.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform==="function")Q.sdp=this.connection.options.sdpTransform(Q.sdp)||Q.sdp;try{await J.setLocalDescription(Q),S.log("Set localDescription:",Q,`for:${this.connection.peer}`),X.socket.send({type:F1.Answer,payload:{sdp:Q,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(Z){X.emitError(V1.WebRTC,Z),S.log("Failed to setLocalDescription, ",Z)}}catch(Q){X.emitError(V1.WebRTC,Q),S.log("Failed to create answer, ",Q)}}async handleSDP(J,X){X=new RTCSessionDescription(X);const Q=this.connection.peerConnection,Z=this.connection.provider;S.log("Setting remote description",X);const G=this;try{if(await Q.setRemoteDescription(X),S.log(`Set remoteDescription:${J} for:${this.connection.peer}`),J==="OFFER")await G._makeAnswer()}catch(H){Z.emitError(V1.WebRTC,H),S.log("Failed to setRemoteDescription, ",H)}}async handleCandidate(J){S.log("handleCandidate:",J);try{await this.connection.peerConnection.addIceCandidate(J),S.log(`Added ICE candidate for:${this.connection.peer}`)}catch(X){this.connection.provider.emitError(V1.WebRTC,X),S.log("Failed to handleCandidate, ",X)}}_addTracksToConnection(J,X){if(S.log(`add tracks from stream ${J.id} to peer connection`),!X.addTrack)return S.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");J.getTracks().forEach((Q)=>{X.addTrack(Q,J)})}_addStreamToMediaConnection(J,X){S.log(`add stream ${J.id} to media connection ${X.connectionId}`),X.addStream(J)}}class _X extends EX.EventEmitter{emitError(J,X){S.error("Error:",X),this.emit("error",new _9(`${J}`,X))}}class _9 extends Error{constructor(J,X){if(typeof X==="string")super(X);else{super();Object.assign(this,X)}this.type=J}}class RX extends _X{get open(){return this._open}constructor(J,X,Q){super();this.peer=J,this.provider=X,this.options=Q,this._open=!1,this.metadata=Q.metadata}}class i0 extends RX{static#J=this.ID_PREFIX="mc_";get type(){return k1.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(J,X,Q){super(J,X,Q);if(this._localStream=this.options._stream,this.connectionId=this.options.connectionId||i0.ID_PREFIX+L1.randomToken(),this._negotiator=new MX(this),this._localStream)this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(J){this.dataChannel=J,this.dataChannel.onopen=()=>{S.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{S.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(J){S.log("Receiving stream",J),this._remoteStream=J,super.emit("stream",J)}handleMessage(J){const{type:X,payload:Q}=J;switch(J.type){case F1.Answer:this._negotiator.handleSDP(X,Q.sdp),this._open=!0;break;case F1.Candidate:this._negotiator.handleCandidate(Q.candidate);break;default:S.warn(`Unrecognized message type:${X} from peer:${this.peer}`);break}}answer(J,X={}){if(this._localStream){S.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}if(this._localStream=J,X&&X.sdpTransform)this.options.sdpTransform=X.sdpTransform;this._negotiator.startConnection({...this.options._payload,_stream:J});const Q=this.provider._getMessages(this.connectionId);for(let Z of Q)this.handleMessage(Z);this._open=!0}close(){if(this._negotiator)this._negotiator.cleanup(),this._negotiator=null;if(this._localStream=null,this._remoteStream=null,this.provider)this.provider._removeConnection(this),this.provider=null;if(this.options&&this.options._stream)this.options._stream=null;if(!this.open)return;this._open=!1,super.emit("close")}}class R9{constructor(J){this._options=J}_buildRequest(J){const X=this._options.secure?"https":"http",{host:Q,port:Z,path:G,key:H}=this._options,K=new URL(`${X}://${Q}:${Z}${G}${H}/${J}`);return K.searchParams.set("ts",`${Date.now()}${Math.random()}`),K.searchParams.set("version",OX.version),fetch(K.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const J=await this._buildRequest("id");if(J.status!==200)throw new Error(`Error. Status:${J.status}`);return J.text()}catch(J){S.error("Error retrieving ID",J);let X="";if(this._options.path==="/"&&this._options.host!==L1.CLOUD_HOST)X=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer.";throw new Error("Could not get an ID from the server."+X)}}async listAllPeers(){try{const J=await this._buildRequest("peers");if(J.status!==200){if(J.status===401){let X="";if(this._options.host===L1.CLOUD_HOST)X="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.";else X="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.";throw new Error("It doesn't look like you have permission to list peers IDs. "+X)}throw new Error(`Error. Status:${J.status}`)}return J.json()}catch(J){throw S.error("Error retrieving list peers",J),new Error("Could not get list peers from the server."+J)}}}class s0 extends RX{static#J=this.ID_PREFIX="dc_";static#X=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return k1.Data}constructor(J,X,Q){super(J,X,Q);this.connectionId=this.options.connectionId||s0.ID_PREFIX+A9(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new MX(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(J){this.dataChannel=J,this.dataChannel.onopen=()=>{S.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=(X)=>{S.log(`DC#${this.connectionId} dc onmessage:`,X.data)},this.dataChannel.onclose=()=>{S.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(J){if(J?.flush){this.send({__peerData:{type:"close"}});return}if(this._negotiator)this._negotiator.cleanup(),this._negotiator=null;if(this.provider)this.provider._removeConnection(this),this.provider=null;if(this.dataChannel)this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null;if(!this.open)return;this._open=!1,super.emit("close")}send(J,X=!1){if(!this.open){this.emitError(_0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(J,X)}async handleMessage(J){const X=J.payload;switch(J.type){case F1.Answer:await this._negotiator.handleSDP(J.type,X.sdp);break;case F1.Candidate:await this._negotiator.handleCandidate(X.candidate);break;default:S.warn("Unrecognized message type:",J.type,"from peer:",this.peer);break}}}class t0 extends s0{get bufferSize(){return this._bufferSize}_initializeDataChannel(J){super._initializeDataChannel(J),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",(X)=>this._handleDataMessage(X))}_bufferedSend(J){if(this._buffering||!this._trySend(J))this._buffer.push(J),this._bufferSize=this._buffer.length}_trySend(J){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>s0.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(J)}catch(X){return S.error(`DC#:${this.connectionId} Error when sending:`,X),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open)return;if(this._buffer.length===0)return;const J=this._buffer[0];if(this._trySend(J))this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer()}close(J){if(J?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...J){super(...J);this._buffer=[],this._bufferSize=0,this._buffering=!1}}class n0 extends t0{close(J){super.close(J),this._chunkedData={}}constructor(J,X,Q){super(J,X,Q);this.chunker=new qX,this.serialization=J0.Binary,this._chunkedData={}}_handleDataMessage({data:J}){const X=gJ(J),Q=X.__peerData;if(Q){if(Q.type==="close"){this.close();return}this._handleChunk(X);return}this.emit("data",X)}_handleChunk(J){const X=J.__peerData,Q=this._chunkedData[X]||{data:[],count:0,total:J.total};if(Q.data[J.n]=new Uint8Array(J.data),Q.count++,this._chunkedData[X]=Q,Q.total===Q.count){delete this._chunkedData[X];const Z=NQ(Q.data);this._handleDataMessage({data:Z})}}_send(J,X){const Q=vJ(J);if(Q instanceof Promise)return this._send_blob(Q);if(!X&&Q.byteLength>this.chunker.chunkedMTU){this._sendChunks(Q);return}this._bufferedSend(Q)}async _send_blob(J){const X=await J;if(X.byteLength>this.chunker.chunkedMTU){this._sendChunks(X);return}this._bufferedSend(X)}_sendChunks(J){const X=this.chunker.chunk(J);S.log(`DC#${this.connectionId} Try to send ${X.length} chunks...`);for(let Q of X)this.send(Q,!0)}}class U9 extends t0{_handleDataMessage({data:J}){super.emit("data",J)}_send(J,X){this._bufferedSend(J)}constructor(...J){super(...J);this.serialization=J0.None}}class T9 extends t0{_handleDataMessage({data:J}){const X=this.parse(this.decoder.decode(J)),Q=X.__peerData;if(Q&&Q.type==="close"){this.close();return}this.emit("data",X)}_send(J,X){const Q=this.encoder.encode(this.stringify(J));if(Q.byteLength>=L1.chunkedMTU){this.emitError(_0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(Q)}constructor(...J){super(...J);this.serialization=J0.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class R0 extends _X{static#J=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const J=Object.create(null);for(let[X,Q]of this._connections)J[X]=Q;return J}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(J,X){super();this._serializers={raw:U9,json:T9,binary:n0,"binary-utf8":n0,default:n0},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let Q;if(J&&J.constructor==Object)X=J;else if(J)Q=J.toString();if(X={debug:0,host:L1.CLOUD_HOST,port:L1.CLOUD_PORT,path:"/",key:R0.DEFAULT_KEY,token:L1.randomToken(),config:L1.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...X},this._options=X,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/")this._options.host=window.location.hostname;if(this._options.path){if(this._options.path[0]!=="/")this._options.path="/"+this._options.path;if(this._options.path[this._options.path.length-1]!=="/")this._options.path+="/"}if(this._options.secure===void 0&&this._options.host!==L1.CLOUD_HOST)this._options.secure=L1.isSecure();else if(this._options.host==L1.CLOUD_HOST)this._options.secure=!0;if(this._options.logFunction)S.setLogFunction(this._options.logFunction);if(S.logLevel=this._options.debug||0,this._api=new R9(X),this._socket=this._createServerConnection(),!L1.supports.audioVideo&&!L1.supports.data){this._delayedAbort(V1.BrowserIncompatible,"The current browser does not support WebRTC");return}if(!!Q&&!L1.validateId(Q)){this._delayedAbort(V1.InvalidID,`ID "${Q}" is invalid`);return}if(Q)this._initialize(Q);else this._api.retrieveId().then((Z)=>this._initialize(Z)).catch((Z)=>this._abort(V1.ServerError,Z))}_createServerConnection(){const J=new M9(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return J.on(S1.Message,(X)=>{this._handleMessage(X)}),J.on(S1.Error,(X)=>{this._abort(V1.SocketError,X)}),J.on(S1.Disconnected,()=>{if(this.disconnected)return;this.emitError(V1.Network,"Lost connection to server."),this.disconnect()}),J.on(S1.Close,()=>{if(this.disconnected)return;this._abort(V1.SocketClosed,"Underlying socket is already closed.")}),J}_initialize(J){this._id=J,this.socket.start(J,this._options.token)}_handleMessage(J){const{type:X,payload:Q,src:Z}=J;switch(X){case F1.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case F1.Error:this._abort(V1.ServerError,Q.msg);break;case F1.IdTaken:this._abort(V1.UnavailableID,`ID "${this.id}" is taken`);break;case F1.InvalidKey:this._abort(V1.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case F1.Leave:S.log(`Received leave message from ${Z}`),this._cleanupPeer(Z),this._connections.delete(Z);break;case F1.Expire:this.emitError(V1.PeerUnavailable,`Could not connect to peer ${Z}`);break;case F1.Offer:{const G=Q.connectionId;let H=this.getConnection(Z,G);if(H)H.close(),S.warn(`Offer received for existing Connection ID:${G}`);if(Q.type===k1.Media){const W=new i0(Z,this,{connectionId:G,_payload:Q,metadata:Q.metadata});H=W,this._addConnection(Z,H),this.emit("call",W)}else if(Q.type===k1.Data){const W=new this._serializers[Q.serialization](Z,this,{connectionId:G,_payload:Q,metadata:Q.metadata,label:Q.label,serialization:Q.serialization,reliable:Q.reliable});H=W,this._addConnection(Z,H),this.emit("connection",W)}else{S.warn(`Received malformed connection type:${Q.type}`);return}const K=this._getMessages(G);for(let W of K)H.handleMessage(W);break}default:{if(!Q){S.warn(`You received a malformed message from ${Z} of type ${X}`);return}const G=Q.connectionId,H=this.getConnection(Z,G);if(H&&H.peerConnection)H.handleMessage(J);else if(G)this._storeMessage(G,J);else S.warn("You received an unrecognized message:",J);break}}}_storeMessage(J,X){if(!this._lostMessages.has(J))this._lostMessages.set(J,[]);this._lostMessages.get(J).push(X)}_getMessages(J){const X=this._lostMessages.get(J);if(X)return this._lostMessages.delete(J),X;return[]}connect(J,X={}){if(X={serialization:"default",...X},this.disconnected){S.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(V1.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const Q=new this._serializers[X.serialization](J,this,X);return this._addConnection(J,Q),Q}call(J,X,Q={}){if(this.disconnected){S.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(V1.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!X){S.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const Z=new i0(J,this,{...Q,_stream:X});return this._addConnection(J,Z),Z}_addConnection(J,X){if(S.log(`add connection ${X.type}:${X.connectionId} to peerId:${J}`),!this._connections.has(J))this._connections.set(J,[]);this._connections.get(J).push(X)}_removeConnection(J){const X=this._connections.get(J.peer);if(X){const Q=X.indexOf(J);if(Q!==-1)X.splice(Q,1)}this._lostMessages.delete(J.connectionId)}getConnection(J,X){const Q=this._connections.get(J);if(!Q)return null;for(let Z of Q)if(Z.connectionId===X)return Z;return null}_delayedAbort(J,X){setTimeout(()=>{this._abort(J,X)},0)}_abort(J,X){if(S.error("Aborting!"),this.emitError(J,X),!this._lastServerId)this.destroy();else this.disconnect()}destroy(){if(this.destroyed)return;S.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close")}_cleanup(){for(let J of this._connections.keys())this._cleanupPeer(J),this._connections.delete(J);this.socket.removeAllListeners()}_cleanupPeer(J){const X=this._connections.get(J);if(!X)return;for(let Q of X)Q.close()}disconnect(){if(this.disconnected)return;const J=this.id;S.log(`Disconnect peer with ID:${J}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=J,this._id=null,this.emit("disconnected",J)}reconnect(){if(this.disconnected&&!this.destroyed)S.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(!this.disconnected&&!this.open)S.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}listAllPeers(J=(X)=>{}){this._api.listAllPeers().then((X)=>J(X)).catch((X)=>this._abort(V1.ServerError,X))}}var a0=!1;async function o0(J){const X=this;if(J.event==="change"){if(await o.intance.Localbase.update(J.data),!a0)X.send({event:"recovery_end",data:Date.now()})}if(J.event==="recovery_pull"){a0=!0;const Q=[];o.intance.Localbase.transacciones.iterate((Z,G)=>{if(Z.ts>=J.data)Q.push(Z)}).then(()=>{const Z=Q.length;if(Z===0)X.send({event:"recovery_end",data:Date.now()}),a0=!1;else{let G=0;const H=setInterval(()=>{if(X.send({event:"recovery_data",data:Q[G]}),G++,G>=Z)clearInterval(H),X.send({event:"recovery_end",data:Date.now()}),a0=!1},50)}})}if(J.event==="recovery_data")await o.intance.Localbase.update(J.data);if(J.event==="read"){const Q=await o.intance.Localbase.read(J.data);X.send({event:"read_result",data:Q})}if(J.event==="recovery_end")await o.intance.Localbase.iDB.setItem(`last_coneccion_${X.peer}`,J.data)}async function UX(){const J=this;o.intance.connecciones=o.intance.connecciones.filter((Z)=>Z.peer!==J.peer),o.intance.connecciones.push(J);const X=await o.intance.Localbase.iDB.getItem(`last_coneccion_${J.peer}`),Q=[];if(X)J.send({event:"recovery_pull",data:X}),o.intance.Localbase.transacciones.iterate((Z,G)=>{if(Z.ts>=X)Q.push(Z)}).then(()=>{const Z=Q.length;if(Z===0)J.send({event:"recovery_end",data:Date.now()});else{let G=0;const H=setInterval(()=>{if(J.send({event:"recovery_data",data:Q[G]}),G++,G>=Z)clearInterval(H),J.send({event:"recovery_end",data:Date.now()})},50)}});else o.intance.Localbase.transacciones.iterate((Z,G)=>{Q.push(Z)}).then(()=>{const Z=Q.length;if(Z===0)J.send({event:"recovery_end",data:Date.now()});else{let G=0;const H=setInterval(()=>{if(J.send({event:"recovery_data",data:Q[G]}),G++,G>=Z)clearInterval(H),J.send({event:"recovery_end",data:Date.now()})},50)}o.intance.Localbase.iDB.setItem(`last_coneccion_${J.peer}`,Date.now())})}function x9(J,X){const Q={};return J.forEach((Z)=>{const G=Z[X];if(!Q[G])Q[G]=[];Q[G].push(Z)}),Q}class o{#J=null;constructor(J,X){if(o.intance)return o.intance;if(!X)throw new Error("Localbase no definido");if(!X.uid)throw new Error("Localbase.uid no definido");if(!X.events)throw new Error("Localbase.events no definido");if(!X.iDB)throw new Error("Localbase.iDB no definido");if(!X.transacciones)throw new Error("Localbase.transacciones no definido");if(this.Localbase=X,this.config=J,this.connecciones=[],X.isCloud=!0,!this.config)throw new Error("Configuracion no definida");if(!this.config.debug)this.config.debug=0;this.promesaConexion=new Promise((Z,G)=>{this.#J=Z});const Q=(Z)=>{this.connecciones.forEach((G)=>{if(G.open)G.send({event:"change",data:Z})})};this.Localbase.iDB.getItem("peerId").then(async(Z)=>{if(X.nodeId=Z,!await this.Localbase.iDB.getItem("createdDB"))await this.Localbase.iDB.setItem("createdDB",Date.now());if(Z)this.peer=new R0(Z,this.config);else this.peer=new R0(this.config);this.peer.on("open",async(H)=>{const K=await this.Localbase.iDB.getItem("open_ultimo");if(!K)await this.Localbase.iDB.setItem("open_ultimo",Date.now());else await this.Localbase.iDB.setItem("open_antiguo",K),await this.Localbase.iDB.setItem("open_ultimo",Date.now());if(this.Localbase.events.on("change",Q),!Z)X.nodeId=H,this.Localbase.iDB.setItem("peerId",H);this.#J()}),this.peer.on("connection",(H)=>{this.connecciones=this.connecciones.filter((K)=>K.peer!==K.peer),this.connecciones.push(H),H.on("data",o0),H.on("close",()=>{this.connecciones=this.connecciones.filter((K)=>K.peer!==K.peer)})}),this.peer.on("error",(H)=>{if(console.warn("[CLOUD ] name: "+H.name+", message: "+H.message+", type: "+H.type),H.type==="network")this.Localbase.iDB.setItem("last_coneccion",this.Localbase.uid()),this.#J();if(H.type==="unavailable-id")this.Localbase.iDB.setItem("last_coneccion",this.Localbase.uid()),this.#J();if(H.type==="peer-unavailable"){this.connecciones=this.connecciones.filter((K)=>K.open),this.Localbase.iDB.setItem("peers",JSON.stringify(this.connecciones.map((K)=>({nodeId:K.peer,label:K.label}))));return}})}),o.intance=this}async init(){await this.promesaConexion}async addNode(J,X){if(!X)throw new Error("nodeId no definido");if(o.intance.peer.id===X)return;let Q=await this.getPeers();Q=Q.filter((Z)=>Z.nodeId!==X),Q.push({nodeId:X,label:J}),await o.intance.Localbase.iDB.setItem("peers",JSON.stringify(Q))}async getPeers(){let J=await o.intance.Localbase.iDB.getItem("peers");if(!J)J=JSON.stringify([]);return JSON.parse(J)}async read(J){const X=await this.Localbase.read(J),Q=this.connecciones.filter((z)=>z.open),Z={};Z[this.peer.id]=X;const G=await new Promise(async(z,F)=>{for(let q of Q)await new Promise((M,O)=>{setTimeout(()=>O("timeout"),1e4),q.send({event:"read",data:J}),q.on("data",(P)=>{if(P.event==="read_result")Z[q.peer]=P.data,M()})});z(Z)});let H=[];for(let z in G){const F=G[z];if(F instanceof Array)H=H.concat(F);else H.push(F)}console.log("resolver",H);const K=x9(H,"_id"),W=[];for(let z in K){const F=K[z];if(F.length>1){const q=F.reduce((M,O)=>{return I0(M,O)>0?M:O});W.push(q)}else W.push(F[0])}if(W.length===0)return null;else if(W.length===1)return W[0];else return W}myId(){return o.intance.peer.id}async removeNode(J){if(!J)throw new Error("nodeId no definido");let X=await this.getPeers();X=X.filter((Q)=>Q.nodeId!==J),await o.intance.Localbase.iDB.setItem("peers",JSON.stringify(X))}static async conectar(){const X=(await o.intance.getPeers()).filter((Q)=>!o.intance.connecciones.find((Z)=>Z.peer===Q.nodeId));for(let{nodeId:Q,label:Z}of X)try{const G=o.intance.peer.connect(Q,{label:Z,reliable:!0});G.on("error",(H)=>{console.warn("[CLOUD ] name: "+H.name+", message: "+H.message+", type: "+H.type)}),G.on("close",()=>{console.warn("[CLOUD ] coneccion cerrada"),o.intance.connecciones=o.intance.connecciones.filter((H)=>H.peer!==G.peer)}),G.on("open",UX),G.on("data",o0)}catch(G){console.warn("[CLOUD ] error al conectar",G)}}}export{m as Localbase,o1 as ConnectRebase,o as Cloud};
