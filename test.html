<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="./dist/localbase.dev.js"></script>
</head>
<body>
  <script>
  async function tested() {
   /*  Localbase.onChange = ( movimiento ) => {
      console.log( 'DB', movimiento )
    }

    Localbase.onChangeDoc = ( movimiento ) => {
      console.log( 'DOCUMENT', movimiento )
    } */
  
    try {
      
      const a = new Array(10).fill('hello')
    
      const db = new Localbase('example',{url:'ws://localhost:4000/listen'})
  
      // para esperar la coneccion con el socket
      await db.conected();
    
      //add to key provista
      await db.collection('test').add({nombre:'CHUP',apellido:'rozas'},'1')
      await db.collection('test').add({nombre:'CHUP'},'2')
  
      console.log('UID: ',db.uid())
    
        //update to key
        await db.collection('test').doc('1').update({nombre:'CHUP@'});
    
        //get to key
        const doc = await db.collection('test').doc('1').get();
        console.log('DOC UPDATE',{doc})
    
      for (let index = 0; index < a.length; index++) {
        const element = a[index];
        await db.collection('test').add({nombre:element+' '+index})
      }
      const tested2 = await db.collection('test').search('chup');
      await db.collection('test').search('chup');
  
      // get where find
      console.log('------------------------- WHERE -------------------------')
      await db.collection('test').where({ nombre:'hello 0' }).get();
      await db.collection('test').where({ nombre_lt:'hello' }).get();
      await db.collection('test').where({ nombre_lte:'hello' }).get();
  
      await db.collection('test').where({ nombre_gt:'hello' }).get();
      await db.collection('test').where({ nombre_gte:'hello' }).get();
  
      await db.collection('test').where({ nombre_ne:'hello' }).get();
  
      console.log('------------------------- INCREMENTER -------------------------')
      await db.collection('test').where({ nombre:'hello 1' }).update({valor: Localbase.increment(500)});
      await db.collection('test').where({ nombre:'hello 2' }).update({valor: Localbase.increment(-500)});
  
      await db.collection('test').where({ nombre:'hello 1' }).get({keys:true});
      await db.collection('test').where({ nombre:'hello 2' }).get({keys:true});
  
      console.log('------------------------- ARRAYUNION -------------------------')
      await db.collection('test').where({ nombre:'hello 1' }).update({valor: Localbase.arrayUnion({like:true})});
      await db.collection('test').where({ nombre:'hello 2' }).update({valor: Localbase.arrayUnion({like:false})});
      await db.collection('test').where({ nombre:'hello 1' }).get({keys:true});
      await db.collection('test').where({ nombre:'hello 2' }).get({keys:true});
  
      console.log('------------------------- ARRAYREMOVE -------------------------')
      await db.collection('test').where({ nombre:'hello 1' }).update({valor: Localbase.arrayRemove({like:true})});
      await db.collection('test').where({ nombre:'hello 2' }).update({valor: Localbase.arrayRemove({like:false})});
      await db.collection('test').where({ nombre:'hello 1' }).get({keys:true});
      await db.collection('test').where({ nombre:'hello 2' }).get({keys:true});
  
    console.log('-------------------------- SEARCH -------------------------')
      setTimeout(async ()=> {
        const tested2 = await db.collection('test').search('roza');
        console.log({tested2})
      },1000)
  
      setTimeout(async ()=> {
        const tested2 = await db.collection('test').search('chup');
        const tested3 = await db.collection('test').search('chup');
        console.log({tested2,tested3})
  
        console.log('-------------------------- DELETE COLLECTION -------------------------')
        await db.collection('test').delete();
    
        console.log('-------------------------- DELETE DB -------------------------')
        await db.delete();
      },5000)
      console.log({tested2})
    
     
    } catch (error) {
      console.trace(error)
    }
    
  }
  tested();
  </script>
</body>
</html>